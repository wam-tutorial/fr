<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="fr-fr" xml:lang="fr-fr"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.9">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<meta name="description" content="Tutoriel sur l’ajustement d’un modèle animal à l’aide de plusieurs packages R. Tutoriels mis à jour et étendus à partir de An ecologist guide to animal model Wilson et al. (2010).">
<title>5&nbsp; Asreml-R – Comment ajuster un modèle animal?</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>

<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./03_03-biv_mcmcglmm.html" rel="next">
<link href="./03_00-biv.html" rel="prev">
<link href="./images/cover/book_fav.png" rel="icon" type="image/png">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-79bb3942e891885f9f7af119cd221462.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-dark-37bb72f48501692975d9c066fdeb097b.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-758c5ce73771950a3d9b163c2677d9fe.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="site_libs/bootstrap/bootstrap-dark.min.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="light"><script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "Pas de résultats",
    "search-matching-documents-text": "documents trouvés",
    "search-copy-link-title": "Copier le lien vers la recherche",
    "search-hide-matches-text": "Cacher les correspondances additionnelles",
    "search-more-match-text": "correspondance de plus dans ce document",
    "search-more-matches-text": "correspondances de plus dans ce document",
    "search-clear-button-title": "Effacer",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Annuler",
    "search-submit-button-title": "Envoyer",
    "search-label": "Recherche"
  }
}</script><script async="" src="https://www.googletagmanager.com/gtag/js?id=G-LLHQEESR2L"></script><script type="text/javascript">

window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-LLHQEESR2L', { 'anonymize_ip': true});
</script><script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script><script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script><script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>
</head>
<body class="nav-sidebar floating nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top"><nav class="navbar navbar-expand-lg " data-bs-theme="dark"><div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">Mas tutoriel</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Recherche"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Basculer la navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
<li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-languages" role="link" data-bs-toggle="dropdown" aria-expanded="false">
      <i class="bi bi-flag" role="img">
</i> 
 <span class="menu-text">Languages</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-languages">
<li>
    <a class="dropdown-item" href="https://wam-tutorial.github.io/en/03_01-biv_asreml.html">
 <span class="dropdown-text">English</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://wam-tutorial.github.io/es">
 <span class="dropdown-text">Español</span></a>
  </li>  
    </ul>
</li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-extra-resources-extra" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Extra Resources Extra</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-extra-resources-extra">
<li>
    <a class="dropdown-item" href="https://wildanimalmodels.org/">
 <span class="dropdown-text">WamWiki</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://devillemereuil.legtux.org/downloads/">
 <span class="dropdown-text">Tutoriels par P de Vilemereuil</span></a>
  </li>  
    </ul>
</li>
</ul>
</div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools tools-wide">
    <a href="https://github.com/wam-tutorial/fr/" title="Code source" class="quarto-navigation-tool px-1" aria-label="Code source"><i class="bi bi-github"></i></a>
    <div class="dropdown">
      <a href="" title="Download" id="quarto-navigation-tool-dropdown-0" class="quarto-navigation-tool dropdown-toggle px-1" data-bs-toggle="dropdown" aria-expanded="false" role="link" aria-label="Download"><i class="bi bi-download"></i></a>
      <ul class="dropdown-menu" aria-labelledby="quarto-navigation-tool-dropdown-0">
<li>
            <a class="dropdown-item quarto-navbar-tools-item" href="./Comment-ajuster-un-modèle-animal-.pdf">
              <i class="bi bi-file-pdf pe-1"></i>
            Download PDF
            </a>
          </li>
          <li>
            <a class="dropdown-item quarto-navbar-tools-item" href="./Comment-ajuster-un-modèle-animal-.epub">
              <i class="bi bi-journal pe-1"></i>
            Download ePub
            </a>
          </li>
      </ul>
</div>
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Basculer le mode sombre"><i class="bi"></i></a>
  <a href="" class="quarto-reader-toggle quarto-navigation-tool px-1" onclick="window.quartoToggleReader(); return false;" title="Basculer en mode lecteur">
  <div class="quarto-reader-toggle-btn">
  <i class="bi"></i>
  </div>
</a>
</div>
      </div> <!-- /container-fluid -->
    </nav><nav class="quarto-secondary-nav"><div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Basculer la barre latérale" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./03_00-biv.html">Multivariate animal model</a></li><li class="breadcrumb-item"><a href="./03_01-biv_asreml.html"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Asreml-R</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Basculer la barre latérale" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
    </div>
  </nav></header><!-- content --><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto"><div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Preface</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./01_intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Introduction</span></span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./02_00-univ.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Univariate animal model</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Basculer la section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./02_01-univ_asreml.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Asreml-R</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./02_03-univ_mcmcglmm.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">MCMCglmm</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./02_04-univ_brms.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">brms</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./03_00-biv.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Multivariate animal model</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true" aria-label="Basculer la section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./03_01-biv_asreml.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Asreml-R</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./03_03-biv_mcmcglmm.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">MCMCglmm</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./03_04-biv_brms.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">brms</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./04_00-rep.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">A repeated measures animal model</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true" aria-label="Basculer la section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./04_01-rep_asreml.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Asreml-R</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./04_03-rep_mcmcglmm.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">MCMCglmm</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./04_04-rep_brms.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">brms</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./05_code_cheatsheet.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Quick comparison of codes</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./98_references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">References</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true">
 <span class="menu-text">Annexes</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true" aria-label="Basculer la section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./99_data.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">A</span>&nbsp; <span class="chapter-title">Données et objet R utilisés dans le livre</span></span></a>
  </div>
</li>
      </ul>
</li>
    </ul>
</div>
</nav><div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active"><h2 id="toc-title">Table des matières</h2>
   
  <ul>
<li><a href="#running-the-model" id="toc-running-the-model" class="nav-link active" data-scroll-target="#running-the-model"><span class="header-section-number">5.0.1</span> Running the model</a></li>
  <li><a href="#adding-fixed-and-random-effects" id="toc-adding-fixed-and-random-effects" class="nav-link" data-scroll-target="#adding-fixed-and-random-effects"><span class="header-section-number">5.0.2</span> Adding fixed and random effects</a></li>
  <li><a href="#significance-testing" id="toc-significance-testing" class="nav-link" data-scroll-target="#significance-testing"><span class="header-section-number">5.0.3</span> Significance testing</a></li>
  <li><a href="#estimate-directly-the-genetic-correlation-within-the-model" id="toc-estimate-directly-the-genetic-correlation-within-the-model" class="nav-link" data-scroll-target="#estimate-directly-the-genetic-correlation-within-the-model"><span class="header-section-number">5.0.4</span> Estimate directly the genetic correlation within the model</a></li>
  <li><a href="#visualisation-of-the-correlation-aka-blup-extraction" id="toc-visualisation-of-the-correlation-aka-blup-extraction" class="nav-link" data-scroll-target="#visualisation-of-the-correlation-aka-blup-extraction"><span class="header-section-number">5.0.5</span> Visualisation of the correlation (aka BLUP extraction)</a></li>
  <li><a href="#partitionning-covariance-between-groups" id="toc-partitionning-covariance-between-groups" class="nav-link" data-scroll-target="#partitionning-covariance-between-groups"><span class="header-section-number">5.0.6</span> Partitionning (co)variance between groups</a></li>
  <li><a href="#between-groups-covariances-and-the-b-matrix" id="toc-between-groups-covariances-and-the-b-matrix" class="nav-link" data-scroll-target="#between-groups-covariances-and-the-b-matrix"><span class="header-section-number">5.0.7</span> Between groups (co)variances and the B-matrix</a></li>
  </ul><div class="toc-actions"><ul><li><a href="https://github.com/wam-tutorial/fr/edit/main/03_01-biv_asreml.qmd" class="toc-action"><i class="bi bi-github"></i>Modifier cette page</a></li><li><a href="https://github.com/wam-tutorial/fr/issues/new" class="toc-action"><i class="bi empty"></i>Faire part d'un problème</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content"><header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./03_00-biv.html">Multivariate animal model</a></li><li class="breadcrumb-item"><a href="./03_01-biv_asreml.html"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Asreml-R</span></a></li></ol></nav><div class="quarto-title">
<h1 class="title"><span id="asreml-biv" class="quarto-section-identifier"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Asreml-R</span></span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header><section id="running-the-model" class="level3" data-number="5.0.1"><h3 data-number="5.0.1" class="anchored" data-anchor-id="running-the-model">
<span class="header-section-number">5.0.1</span> Running the model</h3>
<p>First we need to load the <code>asreml</code> library:</p>
<div class="cell">
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">asreml</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: Matrix</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'Matrix'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following objects are masked from 'package:tidyr':

    expand, pack, unpack</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Online License checked out Tue Oct  8 11:28:37 2024</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading ASReml-R version 4.2</code></pre>
</div>
</div>
<p>For running multivariate analyses in ASReml-R, the code is slightly more complex than for the univariate case. This is because ASReml-R allows us to make different assumptions about the way in which traits might be related. We need to explicitly specify a covariance structure with difference covariance functions <code>us()</code>, <code>idh()</code> or <code>corgh()</code> which for example would estimate an unconstrained (co)variance matrix, an identity matrix and a variance and correlation matrix repestively. We can also specify some starting values for the variance matrices. These can be very approximate <em>guestimates</em> or not at all, but having reasonable starting values can help convergence. It is also possible to let the model running without specifying starting values. Finally, we have increased the default maximum number of iterations (<code>maxiter</code>) which can help to achieve convergence for more complicated models. Another way to increase the number of iteration will be to use the <code>update</code> function. Notes that if the <code>LogLik</code> is not stabilized after several iterations, it is good indication of the model require more iteration.</p>
<div class="cell">
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">ainv</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/asreml/man/ainverse.html">ainverse</a></span><span class="op">(</span><span class="va">gryphonped</span><span class="op">)</span></span>
<span></span>
<span><span class="va">modela</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/asreml/man/asreml.html">asreml</a></span><span class="op">(</span></span>
<span>  fixed <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="va">bwt</span>, <span class="va">tarsus</span><span class="op">)</span> <span class="op">~</span> <span class="va">trait</span>,</span>
<span>  random <span class="op">=</span> <span class="op">~</span> <span class="fu">us</span><span class="op">(</span><span class="va">trait</span>, init <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0.1</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op">:</span><span class="fu">vm</span><span class="op">(</span><span class="va">animal</span>, <span class="va">ainv</span><span class="op">)</span>,</span>
<span>  residual <span class="op">=</span> <span class="op">~</span> <span class="fu">id</span><span class="op">(</span><span class="va">units</span><span class="op">)</span><span class="op">:</span><span class="fu">us</span><span class="op">(</span><span class="va">trait</span>, init <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0.1</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  data <span class="op">=</span> <span class="va">gryphon</span>,</span>
<span>  na.action <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/asreml/man/na.method.html">na.method</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"include"</span>, y <span class="op">=</span> <span class="st">"include"</span><span class="op">)</span>,</span>
<span>  maxit <span class="op">=</span> <span class="fl">20</span></span>
<span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>ASReml Version 4.2 08/10/2024 11:28:37
          LogLik        Sigma2     DF     wall
 1     -7108.741           1.0   1535   11:28:37
 2     -5837.803           1.0   1535   11:28:37
 3     -4437.495           1.0   1535   11:28:37
 4     -3459.378           1.0   1535   11:28:37
 5     -2914.034           1.0   1535   11:28:37
 6     -2729.131           1.0   1535   11:28:37
 7     -2684.659           1.0   1535   11:28:37
 8     -2679.838           1.0   1535   11:28:37
 9     -2679.742           1.0   1535   11:28:37
10     -2679.741           1.0   1535   11:28:37</code></pre>
</div>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">modela</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/update.html">update</a></span><span class="op">(</span><span class="va">modela</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>ASReml Version 4.2 08/10/2024 11:28:37
          LogLik        Sigma2     DF     wall
 1     -2679.741           1.0   1535   11:28:37
 2     -2679.741           1.0   1535   11:28:37</code></pre>
</div>
</div>
<p><code>modela</code> has fitted a bivariate model of <code>bwt</code> and <code>tarsus</code>, with the mean for each of the traits as a fixed effect (<code>trait</code>). The additive genetic variance-covariance matrix (<span class="math inline">\(\textbf{G}\)</span>) is unstructured (<code>us</code>; <em>i.e.</em> all elements are free to vary) and the starting values for <span class="math inline">\(V_A\)</span> for <code>bwt</code>, <span class="math inline">\(COV_A\)</span> between <code>bwt</code> and <code>tarsus</code>, and <span class="math inline">\(V_A\)</span> for <code>tarsus</code> are set to 1, 0.1 and 1, respectively. Similarly, the residual matrix is unstructured and uses the same starting values.</p>
<p>Note that the argument <code>na.action = na.method(x = "include", y = "include")</code> can be added to the model. In a bivariate model, it will help calculate the covariance between two traits with different missing information <code>NA</code> and so help imbalance phenotypage and save sample size. However, it is important to scale ( mean =0, var =1) the two traits to correctly adjust the model(see Asreml-R manual for more information).</p>
<p>Let’s have a look at the variance components, and notice that there are now seven (co)variance components reported in the table:</p>
<div class="cell">
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">modela</span><span class="op">)</span><span class="op">$</span><span class="va">varcomp</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                                           component std.error  z.ratio bound
trait:vm(animal, ainv)!trait_bwt:bwt        3.368397 0.6348307 5.305977     P
trait:vm(animal, ainv)!trait_tarsus:bwt     2.459809 1.0732644 2.291895     P
trait:vm(animal, ainv)!trait_tarsus:tarsus 12.345792 3.0744285 4.015638     P
units:trait!R                               1.000000        NA       NA     F
units:trait!trait_bwt:bwt                   3.849916 0.5200101 7.403541     P
units:trait!trait_tarsus:bwt                3.313282 0.9129234 3.629310     P
units:trait!trait_tarsus:tarsus            17.646432 2.6670380 6.616491     P
                                           %ch
trait:vm(animal, ainv)!trait_bwt:bwt         0
trait:vm(animal, ainv)!trait_tarsus:bwt      0
trait:vm(animal, ainv)!trait_tarsus:tarsus   0
units:trait!R                                0
units:trait!trait_bwt:bwt                    0
units:trait!trait_tarsus:bwt                 0
units:trait!trait_tarsus:tarsus              0</code></pre>
</div>
</div>
<p>The first three terms are related to the genetic matrix and, in order are <span class="math inline">\(V_{A,bwt}\)</span>, <span class="math inline">\(COV_A\)</span>, <span class="math inline">\(V_{A, tarsus}\)</span>. Below is again a line where the <code>units:traitr!R</code> component equals to 1, which again can be ignored. The final three terms relate to the residual matrix and correspond to <span class="math inline">\(V_{R,bwt}\)</span>, <span class="math inline">\(COV_R\)</span>, <span class="math inline">\(V_{R,tarsus}\)</span>. Based on our quick and dirty check (is <code>z.ratio</code> &gt; 1.96?) all components look to be statistically significant.</p>
<p>We can calculate the genetic correlation as <span class="math inline">\(COV_A / \sqrt{V_{A,bwt} \cdot V_{A,tarsus}}\)</span>. Thus this model gives an estimate of <span class="math inline">\(r_A\)</span> = 0.38. It is also possible to estimate the residual correlation <span class="math inline">\(r_{res}\)</span> = 0.4. <!-- C1 issue the annotation of the residual correlation--></p>
<p>Both correlations are distinct in nature. The genetic correlation reflects how much the traits are linked by genetic via polygenic effect or linkage desequilibrium, whereas the residual correlation reflects the environmental correlation or errors measurement correlation.</p>
<p>Although we can calculate this by hand, we can also use <code><a href="https://rdrr.io/pkg/asreml/man/vpredict.html">vpredict()</a></code>, which also provides an (approximate) standard error:</p>
<div class="cell">
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/asreml/man/vpredict.html">vpredict</a></span><span class="op">(</span><span class="va">modela</span>, <span class="va">r_A</span> <span class="op">~</span> <span class="va">V2</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span><span class="op">(</span><span class="va">V1</span> <span class="op">*</span> <span class="va">V3</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     Estimate        SE
r_A 0.3814436 0.1299759</code></pre>
</div>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/asreml/man/vpredict.html">vpredict</a></span><span class="op">(</span><span class="va">modela</span>, <span class="va">r_res</span> <span class="op">~</span> <span class="va">V6</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span><span class="op">(</span><span class="va">V5</span> <span class="op">*</span> <span class="va">V7</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>       Estimate         SE
r_res 0.4019799 0.08607104</code></pre>
</div>
</div>
<p>Of course we can also calculate the heritability of <code>bwt</code> and <code>tarsus</code> from this model:</p>
<div class="cell">
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/asreml/man/vpredict.html">vpredict</a></span><span class="op">(</span><span class="va">modela</span>, <span class="va">h2.bwt</span> <span class="op">~</span> <span class="va">V1</span> <span class="op">/</span> <span class="op">(</span><span class="va">V1</span> <span class="op">+</span> <span class="va">V5</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>       Estimate         SE
h2.bwt 0.466646 0.07671533</code></pre>
</div>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/asreml/man/vpredict.html">vpredict</a></span><span class="op">(</span><span class="va">modela</span>, <span class="va">h2.tarsus</span> <span class="op">~</span> <span class="va">V3</span> <span class="op">/</span> <span class="op">(</span><span class="va">V3</span> <span class="op">+</span> <span class="va">V7</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>           Estimate         SE
h2.tarsus 0.4116331 0.09305863</code></pre>
</div>
</div>
</section><section id="adding-fixed-and-random-effects" class="level3" data-number="5.0.2"><h3 data-number="5.0.2" class="anchored" data-anchor-id="adding-fixed-and-random-effects">
<span class="header-section-number">5.0.2</span> Adding fixed and random effects</h3>
<p>Fixed and random effects can be added just as for the univariate case. Given that our full model of bwt from tutorial 1 had sex as a fixed effect as well as birth year and mother as random effects, we could specify a bivariate formulation with the same complexity:</p>
<div class="cell">
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">modelb</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/asreml/man/asreml.html">asreml</a></span><span class="op">(</span></span>
<span>  fixed <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="va">bwt</span>, <span class="va">tarsus</span><span class="op">)</span> <span class="op">~</span> <span class="va">trait</span> <span class="op">+</span> <span class="fu">at</span><span class="op">(</span><span class="va">trait</span><span class="op">)</span><span class="op">:</span><span class="va">sex</span>,</span>
<span>  random <span class="op">=</span> <span class="op">~</span> <span class="fu">us</span><span class="op">(</span><span class="va">trait</span>, init <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0.1</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op">:</span><span class="fu">vm</span><span class="op">(</span><span class="va">animal</span>, <span class="va">ainv</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">us</span><span class="op">(</span><span class="va">trait</span>, init <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0.1</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op">:</span><span class="va">byear</span> <span class="op">+</span></span>
<span>    <span class="fu">us</span><span class="op">(</span><span class="va">trait</span>, init <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0.1</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op">:</span><span class="va">mother</span>,</span>
<span>  residual <span class="op">=</span> <span class="op">~</span> <span class="fu">id</span><span class="op">(</span><span class="va">units</span><span class="op">)</span><span class="op">:</span><span class="fu">us</span><span class="op">(</span><span class="va">trait</span>, init <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0.1</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  data <span class="op">=</span> <span class="va">gryphon</span>,</span>
<span>  na.action <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/asreml/man/na.method.html">na.method</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"include"</span>, y <span class="op">=</span> <span class="st">"include"</span><span class="op">)</span>,</span>
<span>  maxit <span class="op">=</span> <span class="fl">20</span></span>
<span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>ASReml Version 4.2 08/10/2024 11:28:37
          LogLik        Sigma2     DF     wall
 1     -4672.301           1.0   1533   11:28:38
 2     -4005.616           1.0   1533   11:28:38
 3     -3271.484           1.0   1533   11:28:38  (  1 restrained)
 4     -2761.414           1.0   1533   11:28:38  (  1 restrained)
 5     -2481.355           1.0   1533   11:28:38
 6     -2395.858           1.0   1533   11:28:38
 7     -2381.050           1.0   1533   11:28:38
 8     -2380.251           1.0   1533   11:28:38
 9     -2380.246           1.0   1533   11:28:38</code></pre>
</div>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">modelb</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/update.html">update</a></span><span class="op">(</span><span class="va">modelb</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>ASReml Version 4.2 08/10/2024 11:28:38
          LogLik        Sigma2     DF     wall
 1     -2380.246           1.0   1533   11:28:38
 2     -2380.246           1.0   1533   11:28:38</code></pre>
</div>
</div>
<p>Note that we have specified a covariance structure for each random effect and an estimate of the effect of sex on both birth weight and tarsus length.</p>
<p>There will now be thirteen (co)variance components reported after running the code:</p>
<div class="cell">
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">modelb</span><span class="op">)</span><span class="op">$</span><span class="va">varcomp</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                                            component std.error    z.ratio
trait:byear!trait_bwt:bwt                   0.9746385 0.2825727  3.4491602
trait:byear!trait_tarsus:bwt                0.1624076 0.4185079  0.3880635
trait:byear!trait_tarsus:tarsus             3.7383721 1.2065992  3.0982716
trait:mother!trait_bwt:bwt                  1.1445184 0.2302182  4.9714512
trait:mother!trait_tarsus:bwt              -1.5567306 0.4051848 -3.8420260
trait:mother!trait_tarsus:tarsus            4.8206132 1.3201300  3.6516202
trait:vm(animal, ainv)!trait_bwt:bwt        1.9893546 0.4410246  4.5107569
trait:vm(animal, ainv)!trait_tarsus:bwt     3.3170404 0.9032323  3.6724110
trait:vm(animal, ainv)!trait_tarsus:tarsus 10.2294887 2.8077066  3.6433610
units:trait!R                               1.0000000        NA         NA
units:trait!trait_bwt:bwt                   1.8443110 0.3443178  5.3564203
units:trait!trait_tarsus:bwt                4.0142841 0.7412540  5.4155308
units:trait!trait_tarsus:tarsus            12.4845955 2.2893363  5.4533690
                                           bound %ch
trait:byear!trait_bwt:bwt                      P   0
trait:byear!trait_tarsus:bwt                   P   0
trait:byear!trait_tarsus:tarsus                P   0
trait:mother!trait_bwt:bwt                     P   0
trait:mother!trait_tarsus:bwt                  P   0
trait:mother!trait_tarsus:tarsus               P   0
trait:vm(animal, ainv)!trait_bwt:bwt           P   0
trait:vm(animal, ainv)!trait_tarsus:bwt        P   0
trait:vm(animal, ainv)!trait_tarsus:tarsus     P   0
units:trait!R                                  F   0
units:trait!trait_bwt:bwt                      P   0
units:trait!trait_tarsus:bwt                   P   0
units:trait!trait_tarsus:tarsus                P   0</code></pre>
</div>
</div>
<p>we can estimate the different correlations using <code>vpredict</code>:</p>
<div class="cell">
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/asreml/man/vpredict.html">vpredict</a></span><span class="op">(</span><span class="va">modelb</span>, <span class="va">r_byear</span> <span class="op">~</span> <span class="va">V2</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span><span class="op">(</span><span class="va">V1</span> <span class="op">*</span> <span class="va">V3</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>          Estimate        SE
r_byear 0.08508312 0.2134209</code></pre>
</div>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/asreml/man/vpredict.html">vpredict</a></span><span class="op">(</span><span class="va">modelb</span>, <span class="va">r_M</span> <span class="op">~</span> <span class="va">V5</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span><span class="op">(</span><span class="va">V4</span> <span class="op">*</span> <span class="va">V6</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>      Estimate        SE
r_M -0.6627518 0.2487963</code></pre>
</div>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/asreml/man/vpredict.html">vpredict</a></span><span class="op">(</span><span class="va">modelb</span>, <span class="va">r_A</span> <span class="op">~</span> <span class="va">V8</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span><span class="op">(</span><span class="va">V7</span> <span class="op">*</span> <span class="va">V9</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     Estimate        SE
r_A 0.7353053 0.1094747</code></pre>
</div>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/asreml/man/vpredict.html">vpredict</a></span><span class="op">(</span><span class="va">modelb</span>, <span class="va">r_res</span> <span class="op">~</span> <span class="va">V12</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span><span class="op">(</span><span class="va">V11</span> <span class="op">*</span> <span class="va">V13</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>       Estimate         SE
r_res 0.8365729 0.07366762</code></pre>
</div>
</div>
<p>Now we can look at the fixed effects parameters and assess their significance with a conditional Wald F-test:</p>
<div class="cell">
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">modelb</span>, coef <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">$</span><span class="va">coef.fi</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                            solution std error    z.ratio
trait_bwt                  6.3844483 0.2328210 27.4221324
trait_tarsus              20.5936436 0.5098944 40.3880569
at(trait, 'bwt'):sex_1     0.0000000        NA         NA
at(trait, 'bwt'):sex_2     1.9502053 0.1480467 13.1729086
at(trait, 'tarsus'):sex_1  0.0000000        NA         NA
at(trait, 'tarsus'):sex_2 -0.0684413 0.3823448 -0.1790041</code></pre>
</div>
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/asreml/man/wald.asreml.html">wald.asreml</a></span><span class="op">(</span><span class="va">modelb</span>, denDF <span class="op">=</span> <span class="st">"default"</span>, ssType <span class="op">=</span> <span class="st">"conditional"</span><span class="op">)</span><span class="op">$</span><span class="va">Wald</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>ASReml Version 4.2 08/10/2024 11:28:38
          LogLik        Sigma2     DF     wall
 1     -2380.246           1.0   1533   11:28:39
 2     -2380.246           1.0   1533   11:28:39</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[0;34m
Wald tests for fixed effects.[0m
[0;34mResponse: cbind(bwt, tarsus)[0m

                        Df denDF   F.inc   F.con Margin      Pr
trait                    2  52.6 1396.00 1396.00        0.00000
at(trait, 'bwt'):sex     1 812.8  298.40  173.50      B 0.00000
at(trait, 'tarsus'):sex  1 747.9    0.03    0.03      B 0.85798</code></pre>
</div>
</div>
<p>Note that it is possible to specify a fixed effect to a specific trait by adding the number of order within <code>cbind</code> inside the argument <code>at(trait,x)</code>. For example, here we apply the fixed effect <code>sex</code> only to the response variable <code>tarsus</code>.</p>
<div class="cell">
<div class="sourceCode" id="cb40"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">modelb_2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/asreml/man/asreml.html">asreml</a></span><span class="op">(</span></span>
<span>  fixed <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="va">bwt</span>, <span class="va">tarsus</span><span class="op">)</span> <span class="op">~</span> <span class="va">trait</span> <span class="op">+</span> <span class="fu">at</span><span class="op">(</span><span class="va">trait</span>, <span class="fl">2</span><span class="op">)</span><span class="op">:</span><span class="va">sex</span>,</span>
<span>  random <span class="op">=</span> <span class="op">~</span> <span class="fu">us</span><span class="op">(</span><span class="va">trait</span>, init <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0.1</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op">:</span><span class="fu">vm</span><span class="op">(</span><span class="va">animal</span>, <span class="va">ainv</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">us</span><span class="op">(</span><span class="va">trait</span>, init <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0.1</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op">:</span><span class="va">byear</span> <span class="op">+</span></span>
<span>    <span class="fu">us</span><span class="op">(</span><span class="va">trait</span>, init <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0.1</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op">:</span><span class="va">mother</span>,</span>
<span>  residual <span class="op">=</span> <span class="op">~</span> <span class="fu">id</span><span class="op">(</span><span class="va">units</span><span class="op">)</span><span class="op">:</span><span class="fu">us</span><span class="op">(</span><span class="va">trait</span>, init <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0.1</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  data <span class="op">=</span> <span class="va">gryphon</span>,</span>
<span>  na.action <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/asreml/man/na.method.html">na.method</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"include"</span>, y <span class="op">=</span> <span class="st">"include"</span><span class="op">)</span>,</span>
<span>  maxit <span class="op">=</span> <span class="fl">20</span></span>
<span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>ASReml Version 4.2 08/10/2024 11:28:40
          LogLik        Sigma2     DF     wall
 1     -4810.563           1.0   1534   11:28:40
 2     -4129.799           1.0   1534   11:28:40
 3     -3382.529           1.0   1534   11:28:40  (  1 restrained)
 4     -2864.076           1.0   1534   11:28:40
 5     -2574.891           1.0   1534   11:28:40
 6     -2478.879           1.0   1534   11:28:40
 7     -2458.305           1.0   1534   11:28:40
 8     -2456.425           1.0   1534   11:28:40
 9     -2456.377           1.0   1534   11:28:40
10     -2456.376           1.0   1534   11:28:40</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode" id="cb42"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">modelb_2</span>, coef <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">$</span><span class="va">coef.fi</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                           solution std error   z.ratio
trait_bwt                  7.636226 0.2389515  31.95722
trait_tarsus              22.703658 0.4827348  47.03133
at(trait, 'tarsus'):sex_1  0.000000        NA        NA
at(trait, 'tarsus'):sex_2 -3.267042 0.2953279 -11.06242</code></pre>
</div>
<div class="sourceCode" id="cb44"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/asreml/man/wald.asreml.html">wald.asreml</a></span><span class="op">(</span><span class="va">modelb_2</span>, denDF <span class="op">=</span> <span class="st">"default"</span>, ssType <span class="op">=</span> <span class="st">"conditional"</span><span class="op">)</span><span class="op">$</span><span class="va">Wald</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>ASReml Version 4.2 08/10/2024 11:28:40
          LogLik        Sigma2     DF     wall
 1     -2456.376           1.0   1534   11:28:40
 2     -2456.376           1.0   1534   11:28:40</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[0;34m
Wald tests for fixed effects.[0m
[0;34mResponse: cbind(bwt, tarsus)[0m

                        Df denDF  F.inc  F.con Margin Pr
trait                    2  50.7 1233.0 1233.0         0
at(trait, 'tarsus'):sex  1 522.9  122.4  122.4      B  0</code></pre>
</div>
</div>
</section><section id="significance-testing" class="level3" data-number="5.0.3"><h3 data-number="5.0.3" class="anchored" data-anchor-id="significance-testing">
<span class="header-section-number">5.0.3</span> Significance testing</h3>
<p>Under the model above <span class="math inline">\(r_M\)</span> is estimated as -0.66 and the <code>z.ratio</code> associated with the corresponding covariance (<span class="math inline">\(COV_M\)</span>) is &gt;2 (in absolute terms). We might therefore infer that there is evidence for a strong negative correlation between the traits with respect to the mother and that while maternal identity explains variance in both traits those mothers that tend to produce heavier offspring actually tend to produce offspring with shorter tarsus lengths.</p>
<p>To formally test if <span class="math inline">\(COV_M\)</span> is significantly different from zero, we can compare the log-likelihood for this model:</p>
<div class="cell">
<div class="sourceCode" id="cb47"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">modelb</span><span class="op">$</span><span class="va">loglik</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] -2380.246</code></pre>
</div>
</div>
<p>to a model in which we specify that <span class="math inline">\(COV_M\)</span>=0. Since this constraint reduces the number of parameters to be estimated by one, we can use a likelihood ratio test (LRT) with one degree of freedom. To run the constrained model, we modify the G structure defined for the <code>mother</code> random effect to diagonal (<code>diag</code>), which means we only estimate the variances (the diagonal of the matrix) but not the covariance (the covariance are fixed to 0):</p>
<div class="cell">
<div class="sourceCode" id="cb49"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">modelc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/asreml/man/asreml.html">asreml</a></span><span class="op">(</span></span>
<span>  fixed <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="va">bwt</span>, <span class="va">tarsus</span><span class="op">)</span> <span class="op">~</span> <span class="va">trait</span> <span class="op">+</span> <span class="fu">at</span><span class="op">(</span><span class="va">trait</span><span class="op">)</span><span class="op">:</span><span class="va">sex</span>,</span>
<span>  random <span class="op">=</span> <span class="op">~</span> <span class="fu">us</span><span class="op">(</span><span class="va">trait</span>, init <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0.1</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op">:</span><span class="fu">vm</span><span class="op">(</span><span class="va">animal</span>, <span class="va">ainv</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">us</span><span class="op">(</span><span class="va">trait</span>, init <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0.1</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op">:</span><span class="va">byear</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/diag.html">diag</a></span><span class="op">(</span><span class="va">trait</span>, init <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op">:</span><span class="va">mother</span>,</span>
<span>  residual <span class="op">=</span> <span class="op">~</span> <span class="fu">id</span><span class="op">(</span><span class="va">units</span><span class="op">)</span><span class="op">:</span><span class="fu">us</span><span class="op">(</span><span class="va">trait</span>, init <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0.1</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  data <span class="op">=</span> <span class="va">gryphon</span>,</span>
<span>  na.action <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/asreml/man/na.method.html">na.method</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"include"</span>, y <span class="op">=</span> <span class="st">"include"</span><span class="op">)</span>,</span>
<span>  maxit <span class="op">=</span> <span class="fl">20</span></span>
<span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>ASReml Version 4.2 08/10/2024 11:28:41
          LogLik        Sigma2     DF     wall
 1     -4677.820           1.0   1533   11:28:41
 2     -4010.442           1.0   1533   11:28:41
 3     -3275.409           1.0   1533   11:28:41
 4     -2763.519           1.0   1533   11:28:41
 5     -2483.732           1.0   1533   11:28:41
 6     -2400.242           1.0   1533   11:28:41
 7     -2386.663           1.0   1533   11:28:41
 8     -2386.049           1.0   1533   11:28:41
 9     -2386.045           1.0   1533   11:28:41</code></pre>
</div>
</div>
<p>You can run <code>summary(modelc)$varcomp</code> to confirm this worked. We can now obtain the log-likelihood of this model and compare this to that of <code>modelb</code> using a likelihood ratio test:</p>
<div class="cell">
<div class="sourceCode" id="cb51"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">modelc</span><span class="op">$</span><span class="va">loglik</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] -2386.045</code></pre>
</div>
</div>
<p>We can see that the model log-likelihood is now -2386.05. And comparing the models using a likelihood ratio test:</p>
<div class="cell">
<div class="sourceCode" id="cb53"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fl">2</span> <span class="op">*</span> <span class="op">(</span><span class="va">modelb</span><span class="op">$</span><span class="va">loglik</span> <span class="op">-</span> <span class="va">modelc</span><span class="op">$</span><span class="va">loglik</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 11.59835</code></pre>
</div>
</div>
<p>So our chi-square test statistic is <span class="math inline">\(\chi^2_1\)</span>= 11.6. The p-value that goes with this is obtained by:</p>
<div class="cell">
<div class="sourceCode" id="cb55"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fl">1</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Chisquare.html">pchisq</a></span><span class="op">(</span><span class="fl">2</span> <span class="op">*</span> <span class="op">(</span><span class="va">modelb</span><span class="op">$</span><span class="va">loglik</span> <span class="op">-</span> <span class="va">modelc</span><span class="op">$</span><span class="va">loglik</span><span class="op">)</span>, <span class="fl">1</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.0006601037</code></pre>
</div>
</div>
<p>We would therefore conclude that the maternal covariance is significantly different from zero.</p>
<p>We could apply the same procedure to show that the residual (environmental) covariance and the genetic covariance estimates are significantly greater than zero (<em>i.e.</em>, heavier individuals tend to have longer tarsus lengths). In contrast, we should find that the byear covariance between the two traits is non-significant.</p>
<div class="cell">
<div class="sourceCode" id="cb57"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">modeld</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/asreml/man/asreml.html">asreml</a></span><span class="op">(</span></span>
<span>  fixed <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="va">bwt</span>, <span class="va">tarsus</span><span class="op">)</span> <span class="op">~</span> <span class="va">trait</span> <span class="op">+</span> <span class="fu">at</span><span class="op">(</span><span class="va">trait</span><span class="op">)</span><span class="op">:</span><span class="va">sex</span>,</span>
<span>  random <span class="op">=</span> <span class="op">~</span> <span class="fu">us</span><span class="op">(</span><span class="va">trait</span>, init <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0.1</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op">:</span><span class="fu">vm</span><span class="op">(</span><span class="va">animal</span>, <span class="va">ainv</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/diag.html">diag</a></span><span class="op">(</span><span class="va">trait</span>, init <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op">:</span><span class="va">byear</span> <span class="op">+</span></span>
<span>    <span class="fu">us</span><span class="op">(</span><span class="va">trait</span>, init <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0.1</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op">:</span><span class="va">mother</span>,</span>
<span>  residual <span class="op">=</span> <span class="op">~</span> <span class="fu">id</span><span class="op">(</span><span class="va">units</span><span class="op">)</span><span class="op">:</span><span class="fu">us</span><span class="op">(</span><span class="va">trait</span>, init <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0.1</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  data <span class="op">=</span> <span class="va">gryphon</span>,</span>
<span>  na.action <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/asreml/man/na.method.html">na.method</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"include"</span>, y <span class="op">=</span> <span class="st">"include"</span><span class="op">)</span>,</span>
<span>  maxit <span class="op">=</span> <span class="fl">20</span></span>
<span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>ASReml Version 4.2 08/10/2024 11:28:41
          LogLik        Sigma2     DF     wall
 1     -4672.708           1.0   1533   11:28:42
 2     -4005.954           1.0   1533   11:28:42
 3     -3271.738           1.0   1533   11:28:42  (  1 restrained)
 4     -2761.626           1.0   1533   11:28:42  (  1 restrained)
 5     -2481.647           1.0   1533   11:28:42
 6     -2395.992           1.0   1533   11:28:42
 7     -2381.136           1.0   1533   11:28:42
 8     -2380.331           1.0   1533   11:28:42
 9     -2380.326           1.0   1533   11:28:42</code></pre>
</div>
<div class="sourceCode" id="cb59"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fl">2</span> <span class="op">*</span> <span class="op">(</span><span class="va">modelb</span><span class="op">$</span><span class="va">loglik</span> <span class="op">-</span> <span class="va">modeld</span><span class="op">$</span><span class="va">loglik</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.1600641</code></pre>
</div>
<div class="sourceCode" id="cb61"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fl">1</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Chisquare.html">pchisq</a></span><span class="op">(</span><span class="fl">2</span> <span class="op">*</span> <span class="op">(</span><span class="va">modelb</span><span class="op">$</span><span class="va">loglik</span> <span class="op">-</span> <span class="va">modeld</span><span class="op">$</span><span class="va">loglik</span><span class="op">)</span>, <span class="fl">1</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.6890975</code></pre>
</div>
</div>
</section><section id="estimate-directly-the-genetic-correlation-within-the-model" class="level3" data-number="5.0.4"><h3 data-number="5.0.4" class="anchored" data-anchor-id="estimate-directly-the-genetic-correlation-within-the-model">
<span class="header-section-number">5.0.4</span> Estimate directly the genetic correlation within the model</h3>
<p>Within Asreml-r, different matrix structure can be specify such as <code>us</code>,<code>corg</code>, <code>diag</code>, etc (cf see the Asreml-r guide). Instead of the fitting an unstructured matrix with the argument <code>us</code> or a reduced model with no covariance with the argument <code>diag</code>, we can also directly estimate the genetic correlation between the <code>bwt</code> and <code>tarsus</code> with <code>corgh</code>.</p>
<p>Here we decide to estimate directly the additive genetic correlation.</p>
<div class="cell">
<div class="sourceCode" id="cb63"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">modele</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/asreml/man/asreml.html">asreml</a></span><span class="op">(</span></span>
<span>  fixed <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="va">bwt</span>, <span class="va">tarsus</span><span class="op">)</span> <span class="op">~</span> <span class="va">trait</span> <span class="op">+</span> <span class="fu">at</span><span class="op">(</span><span class="va">trait</span><span class="op">)</span><span class="op">:</span><span class="va">sex</span>,</span>
<span>  random <span class="op">=</span> <span class="op">~</span> <span class="fu">corgh</span><span class="op">(</span><span class="va">trait</span>, init <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.1</span>, <span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op">:</span><span class="fu">vm</span><span class="op">(</span><span class="va">animal</span>, <span class="va">ainv</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">us</span><span class="op">(</span><span class="va">trait</span>, init <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0.1</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op">:</span><span class="va">byear</span> <span class="op">+</span></span>
<span>    <span class="fu">us</span><span class="op">(</span><span class="va">trait</span>, init <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0.1</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op">:</span><span class="va">mother</span>,</span>
<span>  residual <span class="op">=</span> <span class="op">~</span> <span class="fu">id</span><span class="op">(</span><span class="va">units</span><span class="op">)</span><span class="op">:</span><span class="fu">us</span><span class="op">(</span><span class="va">trait</span>, init <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0.1</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  data <span class="op">=</span> <span class="va">gryphon</span>,</span>
<span>  na.action <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/asreml/man/na.method.html">na.method</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"include"</span>, y <span class="op">=</span> <span class="st">"include"</span><span class="op">)</span>,</span>
<span>  maxit <span class="op">=</span> <span class="fl">20</span></span>
<span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>ASReml Version 4.2 08/10/2024 11:28:42
          LogLik        Sigma2     DF     wall
 1     -4672.301           1.0   1533   11:28:42
 2     -4003.183           1.0   1533   11:28:42
 3     -3266.521           1.0   1533   11:28:42  (  1 restrained)
 4     -2757.188           1.0   1533   11:28:42  (  1 restrained)
 5     -2479.291           1.0   1533   11:28:42
 6     -2395.476           1.0   1533   11:28:42
 7     -2381.026           1.0   1533   11:28:42
 8     -2380.251           1.0   1533   11:28:42
 9     -2380.246           1.0   1533   11:28:42</code></pre>
</div>
<div class="sourceCode" id="cb65"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">modele</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/update.html">update</a></span><span class="op">(</span><span class="va">modele</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>ASReml Version 4.2 08/10/2024 11:28:42
          LogLik        Sigma2     DF     wall
 1     -2380.246           1.0   1533   11:28:42
 2     -2380.246           1.0   1533   11:28:43</code></pre>
</div>
<div class="sourceCode" id="cb67"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">modele</span><span class="op">)</span><span class="op">$</span><span class="va">varcomp</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                                                    component std.error
trait:byear!trait_bwt:bwt                           0.9746386 0.2825728
trait:byear!trait_tarsus:bwt                        0.1624071 0.4185082
trait:byear!trait_tarsus:tarsus                     3.7383734 1.2066018
trait:mother!trait_bwt:bwt                          1.1445186 0.2302183
trait:mother!trait_tarsus:bwt                      -1.5567316 0.4051850
trait:mother!trait_tarsus:tarsus                    4.8206154 1.3201324
trait:vm(animal, ainv)!trait!tarsus:!trait!bwt.cor  0.7353061 0.1094807
trait:vm(animal, ainv)!trait_bwt                    1.9893543 0.4410243
trait:vm(animal, ainv)!trait_tarsus                10.2294850 2.8077055
units:trait!R                                       1.0000000        NA
units:trait!trait_bwt:bwt                           1.8443112 0.3443178
units:trait!trait_tarsus:bwt                        4.0142825 0.7412540
units:trait!trait_tarsus:tarsus                    12.4845977 2.2893355
                                                     z.ratio bound %ch
trait:byear!trait_bwt:bwt                           3.449159     P   0
trait:byear!trait_tarsus:bwt                        0.388062     P   0
trait:byear!trait_tarsus:tarsus                     3.098266     P   0
trait:mother!trait_bwt:bwt                          4.971450     P   0
trait:mother!trait_tarsus:bwt                      -3.842027     P   0
trait:mother!trait_tarsus:tarsus                    3.651615     P   0
trait:vm(animal, ainv)!trait!tarsus:!trait!bwt.cor  6.716310     U   0
trait:vm(animal, ainv)!trait_bwt                    4.510758     P   0
trait:vm(animal, ainv)!trait_tarsus                 3.643361     P   0
units:trait!R                                             NA     F   0
units:trait!trait_bwt:bwt                           5.356422     P   0
units:trait!trait_tarsus:bwt                        5.415529     P   0
units:trait!trait_tarsus:tarsus                     5.453372     P   0</code></pre>
</div>
</div>
<p>It is important to note that using <code>corgh</code> change the order of the estimate (co)variance/correlation. Thus, the initial values need to be reorder and all different calculation need to be adjust in consequence. It is also important to check the difference between the model with <code>us</code> and <code>corgh</code> to make sure any mistake are made.</p>
<div class="cell">
<div class="sourceCode" id="cb69"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">modelb</span><span class="op">)</span><span class="op">$</span><span class="va">loglik</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] -2380.246</code></pre>
</div>
<div class="sourceCode" id="cb71"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">modele</span><span class="op">)</span><span class="op">$</span><span class="va">loglik</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] -2380.246</code></pre>
</div>
</div>
<p>There two main advantages to use <code>corgh</code>: first, a direct estimation of correlation within the G matrix can avoid mistake in the <code>vpredict</code> calculation; second, it is possible to test if the correlation is significantly different than 0 (similar result as LRT with the covariance) but also to -1 and 1 which correspond of the correlation boundaries. The following code showed how to create a reduced model with the correlation close to 1 and compared to the initial model. Since we compared the correlation to its boundary, the degree of freedom is only half as a one tail LTR.</p>
<div class="cell">
<div class="sourceCode" id="cb73"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">MODEL_MODIF</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/asreml/man/update.asreml.html">update.asreml</a></span><span class="op">(</span><span class="va">modele</span>, start.values <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></span>
<span><span class="va">G_MOD</span> <span class="op">&lt;-</span> <span class="va">MODEL_MODIF</span><span class="op">$</span><span class="va">vparameters.table</span><span class="op">[</span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">9</span><span class="op">)</span>, <span class="op">]</span></span>
<span><span class="va">G_MOD</span><span class="op">[</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">0.99999</span></span>
<span><span class="va">G_MOD</span><span class="op">[</span><span class="fl">1</span>, <span class="fl">3</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"F"</span></span>
<span><span class="va">modele.red</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/asreml/man/asreml.html">asreml</a></span><span class="op">(</span></span>
<span>  fixed <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="va">bwt</span>, <span class="va">tarsus</span><span class="op">)</span> <span class="op">~</span> <span class="va">trait</span> <span class="op">+</span> <span class="fu">at</span><span class="op">(</span><span class="va">trait</span><span class="op">)</span><span class="op">:</span><span class="va">sex</span>,</span>
<span>  random <span class="op">=</span> <span class="op">~</span> <span class="fu">corgh</span><span class="op">(</span><span class="va">trait</span>, init <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.1</span>, <span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op">:</span><span class="fu">vm</span><span class="op">(</span><span class="va">animal</span>, <span class="va">ainv</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">us</span><span class="op">(</span><span class="va">trait</span>, init <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0.1</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op">:</span><span class="va">byear</span> <span class="op">+</span></span>
<span>    <span class="fu">us</span><span class="op">(</span><span class="va">trait</span>, init <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0.1</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op">:</span><span class="va">mother</span>,</span>
<span>  residual <span class="op">=</span> <span class="op">~</span> <span class="fu">id</span><span class="op">(</span><span class="va">units</span><span class="op">)</span><span class="op">:</span><span class="fu">us</span><span class="op">(</span><span class="va">trait</span>, init <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0.1</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  data <span class="op">=</span> <span class="va">gryphon</span>,</span>
<span>  na.action <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/asreml/man/na.method.html">na.method</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"include"</span>, y <span class="op">=</span> <span class="st">"include"</span><span class="op">)</span>,</span>
<span>  maxit <span class="op">=</span> <span class="fl">20</span>,</span>
<span>  G.param <span class="op">=</span> <span class="va">G_MOD</span></span>
<span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>ASReml Version 4.2 08/10/2024 11:28:43
          LogLik        Sigma2     DF     wall
 1     -2545.233           1.0   1533   11:28:44
 2     -2483.883           1.0   1533   11:28:44
 3     -2423.504           1.0   1533   11:28:44
 4     -2392.509           1.0   1533   11:28:44
 5     -2383.661           1.0   1533   11:28:44
 6     -2383.084           1.0   1533   11:28:44
 7     -2383.033           1.0   1533   11:28:44
 8     -2383.022           1.0   1533   11:28:44
 9     -2383.019           1.0   1533   11:28:44
10     -2383.019           1.0   1533   11:28:44</code></pre>
</div>
<div class="sourceCode" id="cb75"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fl">2</span> <span class="op">*</span> <span class="op">(</span><span class="va">modele</span><span class="op">$</span><span class="va">loglik</span> <span class="op">-</span> <span class="va">modele.red</span><span class="op">$</span><span class="va">loglik</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 5.544679</code></pre>
</div>
<div class="sourceCode" id="cb77"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fl">1</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Chisquare.html">pchisq</a></span><span class="op">(</span><span class="fl">2</span> <span class="op">*</span> <span class="op">(</span><span class="va">modele</span><span class="op">$</span><span class="va">loglik</span> <span class="op">-</span> <span class="va">modele.red</span><span class="op">$</span><span class="va">loglik</span><span class="op">)</span>, df <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.006598676</code></pre>
</div>
</div>
<p>Here, the correlation is significantly different than 1 (~0.99999).</p>
</section><section id="visualisation-of-the-correlation-aka-blup-extraction" class="level3" data-number="5.0.5"><h3 data-number="5.0.5" class="anchored" data-anchor-id="visualisation-of-the-correlation-aka-blup-extraction">
<span class="header-section-number">5.0.5</span> Visualisation of the correlation (aka BLUP extraction)</h3>
<p>When estimating correlation between traits, having a visualization of it can help the interpretation. In addition, visualizing the correlation can spot outliers in the dataset. Thanks to mixed model, each breeding values is stored within the model and can be extract as BLUP (Best Linear Unbiased Predictor).BLUP should be normaly distributed, if not you need to check the assumption of your animal model.</p>
<p>To simplify the following code, we rename the variable T1 and T2.</p>
<div class="cell">
<div class="sourceCode" id="cb79"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">gryphon</span><span class="op">$</span><span class="va">T1</span> <span class="op">&lt;-</span> <span class="va">gryphon</span><span class="op">$</span><span class="va">bwt</span></span>
<span><span class="va">gryphon</span><span class="op">$</span><span class="va">T2</span> <span class="op">&lt;-</span> <span class="va">gryphon</span><span class="op">$</span><span class="va">tarsus</span></span>
<span><span class="co">############</span></span>
<span><span class="va">modele</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/asreml/man/asreml.html">asreml</a></span><span class="op">(</span></span>
<span>  fixed <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="va">T1</span>, <span class="va">T2</span><span class="op">)</span> <span class="op">~</span> <span class="va">trait</span> <span class="op">+</span> <span class="fu">at</span><span class="op">(</span><span class="va">trait</span><span class="op">)</span><span class="op">:</span><span class="va">sex</span>,</span>
<span>  random <span class="op">=</span> <span class="op">~</span> <span class="fu">corgh</span><span class="op">(</span><span class="va">trait</span>, init <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.1</span>, <span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op">:</span><span class="fu">vm</span><span class="op">(</span><span class="va">animal</span>, <span class="va">ainv</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">us</span><span class="op">(</span><span class="va">trait</span>, init <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0.1</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op">:</span><span class="va">byear</span> <span class="op">+</span></span>
<span>    <span class="fu">us</span><span class="op">(</span><span class="va">trait</span>, init <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0.1</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op">:</span><span class="va">mother</span>,</span>
<span>  residual <span class="op">=</span> <span class="op">~</span> <span class="fu">id</span><span class="op">(</span><span class="va">units</span><span class="op">)</span><span class="op">:</span><span class="fu">us</span><span class="op">(</span><span class="va">trait</span>, init <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0.1</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  data <span class="op">=</span> <span class="va">gryphon</span>,</span>
<span>  na.action <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/asreml/man/na.method.html">na.method</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"include"</span>, y <span class="op">=</span> <span class="st">"include"</span><span class="op">)</span>,</span>
<span>  maxit <span class="op">=</span> <span class="fl">20</span></span>
<span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>ASReml Version 4.2 08/10/2024 11:28:44
          LogLik        Sigma2     DF     wall
 1     -4672.301           1.0   1533   11:28:44
 2     -4003.183           1.0   1533   11:28:44
 3     -3266.521           1.0   1533   11:28:45  (  1 restrained)
 4     -2757.188           1.0   1533   11:28:45  (  1 restrained)
 5     -2479.291           1.0   1533   11:28:45
 6     -2395.476           1.0   1533   11:28:45
 7     -2381.026           1.0   1533   11:28:45
 8     -2380.251           1.0   1533   11:28:45
 9     -2380.246           1.0   1533   11:28:45</code></pre>
</div>
<div class="sourceCode" id="cb81"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">modele</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/update.html">update</a></span><span class="op">(</span><span class="va">modele</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>ASReml Version 4.2 08/10/2024 11:28:45
          LogLik        Sigma2     DF     wall
 1     -2380.246           1.0   1533   11:28:45
 2     -2380.246           1.0   1533   11:28:45</code></pre>
</div>
<div class="sourceCode" id="cb83"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">modele</span><span class="op">)</span><span class="op">$</span><span class="va">varcomp</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                                               component std.error   z.ratio
trait:byear!trait_T1:T1                        0.9746386 0.2825728  3.449159
trait:byear!trait_T2:T1                        0.1624071 0.4185082  0.388062
trait:byear!trait_T2:T2                        3.7383734 1.2066018  3.098266
trait:mother!trait_T1:T1                       1.1445186 0.2302183  4.971450
trait:mother!trait_T2:T1                      -1.5567316 0.4051850 -3.842027
trait:mother!trait_T2:T2                       4.8206154 1.3201324  3.651615
trait:vm(animal, ainv)!trait!T2:!trait!T1.cor  0.7353061 0.1094807  6.716310
trait:vm(animal, ainv)!trait_T1                1.9893543 0.4410243  4.510758
trait:vm(animal, ainv)!trait_T2               10.2294850 2.8077055  3.643361
units:trait!R                                  1.0000000        NA        NA
units:trait!trait_T1:T1                        1.8443112 0.3443178  5.356422
units:trait!trait_T2:T1                        4.0142825 0.7412540  5.415529
units:trait!trait_T2:T2                       12.4845977 2.2893355  5.453372
                                              bound %ch
trait:byear!trait_T1:T1                           P   0
trait:byear!trait_T2:T1                           P   0
trait:byear!trait_T2:T2                           P   0
trait:mother!trait_T1:T1                          P   0
trait:mother!trait_T2:T1                          P   0
trait:mother!trait_T2:T2                          P   0
trait:vm(animal, ainv)!trait!T2:!trait!T1.cor     U   0
trait:vm(animal, ainv)!trait_T1                   P   0
trait:vm(animal, ainv)!trait_T2                   P   0
units:trait!R                                     F   0
units:trait!trait_T1:T1                           P   0
units:trait!trait_T2:T1                           P   0
units:trait!trait_T2:T2                           P   0</code></pre>
</div>
<div class="sourceCode" id="cb85"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co">############</span></span>
<span><span class="va">DvsS</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span></span>
<span>  Trait <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span><span class="op">(</span><span class="va">modele</span><span class="op">$</span><span class="va">coefficients</span><span class="op">$</span><span class="va">random</span><span class="op">)</span>,</span>
<span>  BLUP <span class="op">=</span> <span class="va">modele</span><span class="op">$</span><span class="va">coefficients</span><span class="op">$</span><span class="va">random</span>,</span>
<span>  SE <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span><span class="op">(</span><span class="va">modele</span><span class="op">$</span><span class="va">vcoeff</span><span class="op">$</span><span class="va">random</span> <span class="op">*</span> <span class="va">modele</span><span class="op">$</span><span class="va">sigma2</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="va">DvsS</span><span class="op">$</span><span class="va">ID</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/substr.html">substr</a></span><span class="op">(</span><span class="va">DvsS</span><span class="op">$</span><span class="va">Trait</span>, <span class="fl">27</span>, <span class="fl">30</span><span class="op">)</span></span>
<span><span class="va">DvsS</span><span class="op">$</span><span class="va">TRAIT</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/substr.html">substr</a></span><span class="op">(</span><span class="va">DvsS</span><span class="op">$</span><span class="va">Trait</span>, <span class="fl">7</span>, <span class="fl">8</span><span class="op">)</span></span>
<span><span class="va">DvsS</span> <span class="op">&lt;-</span> <span class="va">DvsS</span><span class="op">[</span><span class="fl">927</span><span class="op">:</span><span class="fl">3544</span>, <span class="op">]</span> <span class="co"># keep only row associated to animal</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">DvsS</span><span class="op">$</span><span class="va">TRAIT</span><span class="op">)</span><span class="op">)</span> <span class="co"># 1309 each</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  T1   T2 
 846 1772 </code></pre>
</div>
<div class="sourceCode" id="cb87"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co">#</span></span>
<span><span class="va">DvsS</span><span class="op">$</span><span class="va">Trait</span> <span class="op">&lt;-</span> <span class="cn">NULL</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">DvsS</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"BLUP"</span></span>
<span><span class="va">BLUPS</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/reshape.html">reshape</a></span><span class="op">(</span><span class="va">DvsS</span>, v.names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"BLUP"</span>, <span class="st">"SE"</span><span class="op">)</span>, idvar <span class="op">=</span> <span class="st">"ID"</span>, timevar <span class="op">=</span> <span class="st">"TRAIT"</span>, direction <span class="op">=</span> <span class="st">"wide"</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in reshapeWide(data, idvar = idvar, timevar = timevar, varying =
varying, : multiple rows match for TRAIT=T1: first taken</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in reshapeWide(data, idvar = idvar, timevar = timevar, varying =
varying, : multiple rows match for TRAIT=T2: first taken</code></pre>
</div>
<div class="sourceCode" id="cb90"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">BLUPS</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1310</code></pre>
</div>
<div class="sourceCode" id="cb92"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span><span class="op">(</span><span class="va">BLUPS</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">BLUPS</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"ID"</span>, <span class="st">"BLUP.btw"</span>, <span class="st">"SE.btw"</span>, <span class="st">"BLUP.tarsus"</span>, <span class="st">"SE.tarsus"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">BLUPS</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>      ID               BLUP.btw           SE.btw        BLUP.tarsus      
 Length:1310        Min.   :-2.3778   Min.   :0.7494   Min.   :-6.34104  
 Class :character   1st Qu.:-0.5797   1st Qu.:0.9993   1st Qu.:-1.14403  
 Mode  :character   Median : 0.0350   Median :1.0223   Median :-0.02524  
                    Mean   :-0.0082   Mean   :1.0640   Mean   : 0.02189  
                    3rd Qu.: 0.5911   3rd Qu.:1.0552   3rd Qu.: 1.17735  
                    Max.   : 3.0123   Max.   :1.4377   Max.   : 6.71502  
                    NA's   :926       NA's   :926                        
   SE.tarsus    
 Min.   :1.616  
 1st Qu.:2.371  
 Median :2.451  
 Mean   :2.576  
 3rd Qu.:2.810  
 Max.   :3.287  
                </code></pre>
</div>
<div class="sourceCode" id="cb94"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># write.csv(BLUPS,file="BLUPS_6x6.csv",row.names=F)</span></span>
<span><span class="co">############</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span><span class="op">(</span>mfrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/hist.html">hist</a></span><span class="op">(</span><span class="va">BLUPS</span><span class="op">$</span><span class="va">BLUP.btw</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/qqnorm.html">qqnorm</a></span><span class="op">(</span><span class="va">BLUPS</span><span class="op">$</span><span class="va">BLUP.btw</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/qqnorm.html">qqline</a></span><span class="op">(</span><span class="va">BLUPS</span><span class="op">$</span><span class="va">BLUP.btw</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/hist.html">hist</a></span><span class="op">(</span><span class="va">BLUPS</span><span class="op">$</span><span class="va">BLUP.tarsus</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/qqnorm.html">qqnorm</a></span><span class="op">(</span><span class="va">BLUPS</span><span class="op">$</span><span class="va">BLUP.tarsus</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/qqnorm.html">qqline</a></span><span class="op">(</span><span class="va">BLUPS</span><span class="op">$</span><span class="va">BLUP.tarsus</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="03_01-biv_asreml_files/figure-html/unnamed-chunk-24-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode" id="cb95"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co">#</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Here, some simple code to plot the genetic correlation.</p>
<div class="cell">
<div class="sourceCode" id="cb96"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">BLUP.tarsus</span> <span class="op">~</span> <span class="va">BLUP.btw</span>, <span class="va">BLUPS</span>, xlab <span class="op">=</span> <span class="st">""</span>, ylab <span class="op">=</span> <span class="st">""</span>, las <span class="op">=</span> <span class="fl">1.2</span>, bty <span class="op">=</span> <span class="st">"o"</span>, col <span class="op">=</span> <span class="st">"white"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/arrows.html">arrows</a></span><span class="op">(</span>x0 <span class="op">=</span> <span class="va">BLUPS</span><span class="op">$</span><span class="va">BLUP.btw</span>, y0 <span class="op">=</span> <span class="va">BLUPS</span><span class="op">$</span><span class="va">BLUP.tarsus</span> <span class="op">-</span> <span class="va">BLUPS</span><span class="op">$</span><span class="va">SE.tarsus</span>, x1 <span class="op">=</span> <span class="va">BLUPS</span><span class="op">$</span><span class="va">BLUP.btw</span>, y1 <span class="op">=</span> <span class="va">BLUPS</span><span class="op">$</span><span class="va">BLUP.tarsus</span> <span class="op">+</span> <span class="va">BLUPS</span><span class="op">$</span><span class="va">SE.tarsus</span>, col <span class="op">=</span> <span class="st">"black"</span>, code <span class="op">=</span> <span class="fl">3</span>, angle <span class="op">=</span> <span class="fl">90</span>, length <span class="op">=</span> <span class="fl">0</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/arrows.html">arrows</a></span><span class="op">(</span>x0 <span class="op">=</span> <span class="va">BLUPS</span><span class="op">$</span><span class="va">BLUP.btw</span> <span class="op">-</span> <span class="va">BLUPS</span><span class="op">$</span><span class="va">SE.btw</span>, y0 <span class="op">=</span> <span class="va">BLUPS</span><span class="op">$</span><span class="va">BLUP.tarsus</span>, x1 <span class="op">=</span> <span class="va">BLUPS</span><span class="op">$</span><span class="va">BLUP.btw</span> <span class="op">+</span> <span class="va">BLUPS</span><span class="op">$</span><span class="va">SE.btw</span>, y1 <span class="op">=</span> <span class="va">BLUPS</span><span class="op">$</span><span class="va">BLUP.tarsus</span>, col <span class="op">=</span> <span class="st">"black"</span>, code <span class="op">=</span> <span class="fl">3</span>, angle <span class="op">=</span> <span class="fl">90</span>, length <span class="op">=</span> <span class="fl">0</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/points.html">points</a></span><span class="op">(</span><span class="va">BLUP.tarsus</span> <span class="op">~</span> <span class="va">BLUP.btw</span>, <span class="va">BLUPS</span>, pch <span class="op">=</span> <span class="fl">16</span>, col <span class="op">=</span> <span class="st">"red"</span>, cex <span class="op">=</span> <span class="fl">1.5</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/points.html">points</a></span><span class="op">(</span><span class="va">BLUP.tarsus</span> <span class="op">~</span> <span class="va">BLUP.btw</span>, <span class="va">BLUPS</span>, pch <span class="op">=</span> <span class="fl">1</span>, col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grDevices/rgb.html">rgb</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0.3</span><span class="op">)</span>, cex <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1.5</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/mtext.html">mtext</a></span><span class="op">(</span><span class="st">"btw (BV±SE)"</span>, side <span class="op">=</span> <span class="fl">1</span>, line <span class="op">=</span> <span class="fl">2.4</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/mtext.html">mtext</a></span><span class="op">(</span><span class="st">"tarsus (BV±SE)"</span>, side <span class="op">=</span> <span class="fl">2</span>, line <span class="op">=</span> <span class="fl">2</span>, las <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/mtext.html">mtext</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/expression.html">expression</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="fu">italic</span><span class="op">(</span><span class="va">r</span><span class="op">)</span><span class="op">[</span><span class="va">A</span><span class="op">]</span>, <span class="st">" = 0.7353065 ±  0.1094838"</span><span class="op">)</span><span class="op">)</span>, side <span class="op">=</span> <span class="fl">1</span>, line <span class="op">=</span> <span class="op">-</span><span class="fl">1</span>, adj <span class="op">=</span> <span class="fl">0.95</span>, cex <span class="op">=</span> <span class="fl">0.9</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="03_01-biv_asreml_files/figure-html/unnamed-chunk-25-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section><section id="partitionning-covariance-between-groups" class="level3" data-number="5.0.6"><h3 data-number="5.0.6" class="anchored" data-anchor-id="partitionning-covariance-between-groups">
<span class="header-section-number">5.0.6</span> Partitionning (co)variance between groups</h3>
<p>Similar to the univariate model, it is possible to partition the variance and also the covariance between different groups within the dataset. Here, we can estimate sex-specific genetic correlation. Note, to partition a correlation, it is require to have important sample size within each group. For this example, we simplify the model !</p>
<div class="cell">
<div class="sourceCode" id="cb97"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">gryphon</span> <span class="op">&lt;-</span> <span class="va">gryphon</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/order.html">order</a></span><span class="op">(</span><span class="va">gryphon</span><span class="op">$</span><span class="va">sex</span><span class="op">)</span>, <span class="op">]</span></span>
<span><span class="va">model_sex</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/asreml/man/asreml.html">asreml</a></span><span class="op">(</span></span>
<span>  fixed <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="va">bwt</span>, <span class="va">tarsus</span><span class="op">)</span> <span class="op">~</span> <span class="va">trait</span> <span class="op">+</span> <span class="fu">at</span><span class="op">(</span><span class="va">trait</span><span class="op">)</span><span class="op">:</span><span class="va">sex</span>,</span>
<span>  random <span class="op">=</span> <span class="op">~</span> <span class="fu">at</span><span class="op">(</span><span class="va">sex</span><span class="op">)</span><span class="op">:</span><span class="fu">us</span><span class="op">(</span><span class="va">trait</span>, init <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0.1</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op">:</span><span class="fu">vm</span><span class="op">(</span><span class="va">animal</span>, <span class="va">ainv</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">us</span><span class="op">(</span><span class="va">trait</span>, init <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0.1</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op">:</span><span class="va">byear</span> <span class="op">+</span></span>
<span>    <span class="fu">us</span><span class="op">(</span><span class="va">trait</span>, init <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0.1</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op">:</span><span class="va">mother</span>,</span>
<span>  residual <span class="op">=</span> <span class="op">~</span> <span class="fu">dsum</span><span class="op">(</span><span class="op">~</span> <span class="fu">id</span><span class="op">(</span><span class="va">units</span><span class="op">)</span><span class="op">:</span><span class="fu">us</span><span class="op">(</span><span class="va">trait</span><span class="op">)</span> <span class="op">|</span> <span class="va">sex</span><span class="op">)</span>,</span>
<span>  data <span class="op">=</span> <span class="va">gryphon</span>,</span>
<span>  na.action <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/asreml/man/na.method.html">na.method</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"include"</span>, y <span class="op">=</span> <span class="st">"include"</span><span class="op">)</span>,</span>
<span>  maxit <span class="op">=</span> <span class="fl">20</span></span>
<span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>ASReml Version 4.2 08/10/2024 11:28:46
          LogLik        Sigma2     DF     wall
 1     -2522.729           1.0   1807   11:28:46  (  1 restrained)
 2     -2459.512           1.0   1807   11:28:46  (  3 restrained)
 3     -2408.940           1.0   1807   11:28:46
 4     -2392.691           1.0   1807   11:28:46
 5     -2388.962           1.0   1807   11:28:46
 6     -2388.743           1.0   1807   11:28:46
 7     -2388.736           1.0   1807   11:28:46
 8     -2388.736           1.0   1807   11:28:46</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in asreml(fixed = cbind(bwt, tarsus) ~ trait + at(trait):sex, random =
~at(sex):us(trait, : Warning : US updates modified 1 times in iteration 2 to
remain positive definite.</code></pre>
</div>
<div class="sourceCode" id="cb100"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">model_sex</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/update.html">update</a></span><span class="op">(</span><span class="va">model_sex</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>ASReml Version 4.2 08/10/2024 11:28:46
          LogLik        Sigma2     DF     wall
 1     -2388.736           1.0   1807   11:28:47
 2     -2388.736           1.0   1807   11:28:47</code></pre>
</div>
<div class="sourceCode" id="cb102"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">model_sex</span><span class="op">)</span><span class="op">$</span><span class="va">varcomp</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                                                         component std.error
trait:byear!trait_bwt:bwt                                0.9858478 0.2863878
trait:byear!trait_tarsus:bwt                             0.1525063 0.4334263
trait:byear!trait_tarsus:tarsus                          3.9981983 1.2798747
trait:mother!trait_bwt:bwt                               1.3312734 0.2484444
trait:mother!trait_tarsus:bwt                           -1.6174228 0.4283851
trait:mother!trait_tarsus:tarsus                         4.7542338 1.3546517
at(sex, '1'):trait:vm(animal, ainv)!trait_bwt:bwt        1.3402853 0.5670773
at(sex, '1'):trait:vm(animal, ainv)!trait_tarsus:bwt     2.3608392 1.1348473
at(sex, '1'):trait:vm(animal, ainv)!trait_tarsus:tarsus  6.0625993 3.1304394
at(sex, '2'):trait:vm(animal, ainv)!trait_bwt:bwt        1.8645998 0.8888206
at(sex, '2'):trait:vm(animal, ainv)!trait_tarsus:bwt     5.0954811 2.0684729
at(sex, '2'):trait:vm(animal, ainv)!trait_tarsus:tarsus 14.9771870 6.4479787
sex_1!R                                                  1.0000000        NA
sex_1!trait_bwt:bwt                                      2.3079850 0.5015651
sex_1!trait_tarsus:bwt                                   4.4287898 1.0376370
sex_1!trait_tarsus:tarsus                               13.4857819 2.9284922
sex_2!R                                                  1.0000000        NA
sex_2!trait_bwt:bwt                                      1.7956612 0.7549779
sex_2!trait_tarsus:bwt                                   2.6340448 1.7685804
sex_2!trait_tarsus:tarsus                                9.6094528 5.4917853
                                                           z.ratio bound %ch
trait:byear!trait_bwt:bwt                                3.4423530     P   0
trait:byear!trait_tarsus:bwt                             0.3518622     P   0
trait:byear!trait_tarsus:tarsus                          3.1238982     P   0
trait:mother!trait_bwt:bwt                               5.3584371     P   0
trait:mother!trait_tarsus:bwt                           -3.7756279     P   0
trait:mother!trait_tarsus:tarsus                         3.5095618     P   0
at(sex, '1'):trait:vm(animal, ainv)!trait_bwt:bwt        2.3634965     P   0
at(sex, '1'):trait:vm(animal, ainv)!trait_tarsus:bwt     2.0803144     P   0
at(sex, '1'):trait:vm(animal, ainv)!trait_tarsus:tarsus  1.9366608     P   0
at(sex, '2'):trait:vm(animal, ainv)!trait_bwt:bwt        2.0978361     P   0
at(sex, '2'):trait:vm(animal, ainv)!trait_tarsus:bwt     2.4634024     P   0
at(sex, '2'):trait:vm(animal, ainv)!trait_tarsus:tarsus  2.3227724     P   0
sex_1!R                                                         NA     F   0
sex_1!trait_bwt:bwt                                      4.6015657     P   0
sex_1!trait_tarsus:bwt                                   4.2681493     P   0
sex_1!trait_tarsus:tarsus                                4.6050257     P   0
sex_2!R                                                         NA     F   0
sex_2!trait_bwt:bwt                                      2.3784288     P   0
sex_2!trait_tarsus:bwt                                   1.4893554     P   0
sex_2!trait_tarsus:tarsus                                1.7497867     P   0</code></pre>
</div>
</div>
<p>we can estimate the different correlations using <code>vpredict</code>:</p>
<div class="cell">
<div class="sourceCode" id="cb104"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/asreml/man/vpredict.html">vpredict</a></span><span class="op">(</span><span class="va">model_sex</span>, <span class="va">r_byear</span> <span class="op">~</span> <span class="va">V2</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span><span class="op">(</span><span class="va">V1</span> <span class="op">*</span> <span class="va">V3</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>          Estimate       SE
r_byear 0.07681584 0.213141</code></pre>
</div>
<div class="sourceCode" id="cb106"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/asreml/man/vpredict.html">vpredict</a></span><span class="op">(</span><span class="va">model_sex</span>, <span class="va">r_M</span> <span class="op">~</span> <span class="va">V5</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span><span class="op">(</span><span class="va">V4</span> <span class="op">*</span> <span class="va">V6</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>      Estimate       SE
r_M -0.6429092 0.248944</code></pre>
</div>
<div class="sourceCode" id="cb108"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/asreml/man/vpredict.html">vpredict</a></span><span class="op">(</span><span class="va">model_sex</span>, <span class="va">r_A.1</span> <span class="op">~</span> <span class="va">V8</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span><span class="op">(</span><span class="va">V7</span> <span class="op">*</span> <span class="va">V9</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>       Estimate        SE
r_A.1 0.8282059 0.1723596</code></pre>
</div>
<div class="sourceCode" id="cb110"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/asreml/man/vpredict.html">vpredict</a></span><span class="op">(</span><span class="va">model_sex</span>, <span class="va">r_A.2</span> <span class="op">~</span> <span class="va">V11</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span><span class="op">(</span><span class="va">V10</span> <span class="op">*</span> <span class="va">V12</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>       Estimate        SE
r_A.2 0.9642225 0.1241668</code></pre>
</div>
<div class="sourceCode" id="cb112"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/asreml/man/vpredict.html">vpredict</a></span><span class="op">(</span><span class="va">model_sex</span>, <span class="va">r_res.1</span> <span class="op">~</span> <span class="va">V15</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span><span class="op">(</span><span class="va">V14</span> <span class="op">*</span> <span class="va">V16</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>         Estimate         SE
r_res.1 0.7938355 0.07892634</code></pre>
</div>
<div class="sourceCode" id="cb114"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/asreml/man/vpredict.html">vpredict</a></span><span class="op">(</span><span class="va">model_sex</span>, <span class="va">r_res.2</span> <span class="op">~</span> <span class="va">V19</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span><span class="op">(</span><span class="va">V18</span> <span class="op">*</span> <span class="va">V20</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>         Estimate        SE
r_res.2 0.6341057 0.1894837</code></pre>
</div>
</div>
<p>and the heritability too:</p>
<div class="cell">
<div class="sourceCode" id="cb116"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/asreml/man/vpredict.html">vpredict</a></span><span class="op">(</span><span class="va">model_sex</span>, <span class="va">h2.bwt.1</span> <span class="op">~</span> <span class="va">V7</span> <span class="op">/</span> <span class="op">(</span><span class="va">V1</span> <span class="op">+</span> <span class="va">V4</span> <span class="op">+</span> <span class="va">V7</span> <span class="op">+</span> <span class="va">V14</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>          Estimate         SE
h2.bwt.1 0.2246768 0.09176827</code></pre>
</div>
<div class="sourceCode" id="cb118"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/asreml/man/vpredict.html">vpredict</a></span><span class="op">(</span><span class="va">model_sex</span>, <span class="va">h2.bwt.2</span> <span class="op">~</span> <span class="va">V10</span> <span class="op">/</span> <span class="op">(</span><span class="va">V1</span> <span class="op">+</span> <span class="va">V4</span> <span class="op">+</span> <span class="va">V10</span> <span class="op">+</span> <span class="va">V18</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>          Estimate        SE
h2.bwt.2 0.3119425 0.1442547</code></pre>
</div>
<div class="sourceCode" id="cb120"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/asreml/man/vpredict.html">vpredict</a></span><span class="op">(</span><span class="va">model_sex</span>, <span class="va">h2.tarsus.1</span> <span class="op">~</span> <span class="va">V9</span> <span class="op">/</span> <span class="op">(</span><span class="va">V3</span> <span class="op">+</span> <span class="va">V6</span> <span class="op">+</span> <span class="va">V9</span> <span class="op">+</span> <span class="va">V16</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>            Estimate        SE
h2.tarsus.1  0.21422 0.1070464</code></pre>
</div>
<div class="sourceCode" id="cb122"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/asreml/man/vpredict.html">vpredict</a></span><span class="op">(</span><span class="va">model_sex</span>, <span class="va">h2.tarsus.2</span> <span class="op">~</span> <span class="va">V12</span> <span class="op">/</span> <span class="op">(</span><span class="va">V3</span> <span class="op">+</span> <span class="va">V6</span> <span class="op">+</span> <span class="va">V12</span> <span class="op">+</span> <span class="va">V20</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>             Estimate        SE
h2.tarsus.2 0.4492383 0.1833858</code></pre>
</div>
</div>
<p>Now we can look at the fixed effects parameters and assess their significance with a conditional Wald F-test:</p>
<div class="cell">
<div class="sourceCode" id="cb124"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">model_sex</span>, coef <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">$</span><span class="va">coef.fi</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                            solution std error    z.ratio
trait_bwt                  6.3779149 0.2311766 27.5889321
trait_tarsus              20.5838787 0.4942649 41.6454395
at(trait, 'bwt'):sex_1     0.0000000        NA         NA
at(trait, 'bwt'):sex_2     1.9393688 0.1903239 10.1898321
at(trait, 'tarsus'):sex_1  0.0000000        NA         NA
at(trait, 'tarsus'):sex_2 -0.0554799 0.4758708 -0.1165861</code></pre>
</div>
<div class="sourceCode" id="cb126"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/asreml/man/wald.asreml.html">wald.asreml</a></span><span class="op">(</span><span class="va">model_sex</span>, denDF <span class="op">=</span> <span class="st">"default"</span>, ssType <span class="op">=</span> <span class="st">"conditional"</span><span class="op">)</span><span class="op">$</span><span class="va">Wald</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>ASReml Version 4.2 08/10/2024 11:28:47
          LogLik        Sigma2     DF     wall
 1     -2388.736           1.0   1807   11:28:47
 2     -2388.736           1.0   1807   11:28:47</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[0;34m
Wald tests for fixed effects.[0m
[0;34mResponse: cbind(bwt, tarsus)[0m

                        Df denDF   F.inc   F.con Margin      Pr
trait                    2  44.8 1522.00 1522.00        0.00000
at(trait, 'bwt'):sex     1 137.5  220.90  103.80      B 0.00000
at(trait, 'tarsus'):sex  1 138.6    0.01    0.01      B 0.90737</code></pre>
</div>
</div>
<p>To assess the significant of the covariance, a LTR test can be done with a reduced model where a specific covariance can be fixed to 0 (for example the female covariance, following code).</p>
<div class="cell">
<div class="sourceCode" id="cb129"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">model_modif</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/asreml/man/update.asreml.html">update.asreml</a></span><span class="op">(</span><span class="va">model_sex</span>, start.values <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></span>
<span><span class="va">G</span> <span class="op">&lt;-</span> <span class="va">model_modif</span><span class="op">$</span><span class="va">vparameters</span><span class="op">[</span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">12</span><span class="op">)</span>, <span class="op">]</span></span>
<span><span class="va">G</span><span class="op">$</span><span class="va">Constraint</span><span class="op">[</span><span class="op">(</span><span class="fl">2</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"F"</span></span>
<span><span class="va">G</span><span class="op">$</span><span class="va">Value</span><span class="op">[</span><span class="op">(</span><span class="fl">2</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span><span class="co">#</span></span>
<span><span class="va">reduc.model_sex</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/asreml/man/asreml.html">asreml</a></span><span class="op">(</span></span>
<span>  fixed <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="va">bwt</span>, <span class="va">tarsus</span><span class="op">)</span> <span class="op">~</span> <span class="va">trait</span> <span class="op">+</span> <span class="fu">at</span><span class="op">(</span><span class="va">trait</span><span class="op">)</span><span class="op">:</span><span class="va">sex</span>,</span>
<span>  random <span class="op">=</span> <span class="op">~</span> <span class="fu">at</span><span class="op">(</span><span class="va">sex</span><span class="op">)</span><span class="op">:</span><span class="fu">us</span><span class="op">(</span><span class="va">trait</span>, init <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0.1</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op">:</span><span class="fu">vm</span><span class="op">(</span><span class="va">animal</span>, <span class="va">ainv</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">us</span><span class="op">(</span><span class="va">trait</span>, init <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0.1</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op">:</span><span class="va">byear</span> <span class="op">+</span></span>
<span>    <span class="fu">us</span><span class="op">(</span><span class="va">trait</span>, init <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0.1</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op">:</span><span class="va">mother</span>,</span>
<span>  residual <span class="op">=</span> <span class="op">~</span> <span class="fu">dsum</span><span class="op">(</span><span class="op">~</span> <span class="fu">id</span><span class="op">(</span><span class="va">units</span><span class="op">)</span><span class="op">:</span><span class="fu">us</span><span class="op">(</span><span class="va">trait</span><span class="op">)</span> <span class="op">|</span> <span class="va">sex</span><span class="op">)</span>,</span>
<span>  data <span class="op">=</span> <span class="va">gryphon</span>,</span>
<span>  na.action <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/asreml/man/na.method.html">na.method</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"include"</span>, y <span class="op">=</span> <span class="st">"include"</span><span class="op">)</span>,</span>
<span>  maxit <span class="op">=</span> <span class="fl">20</span>,</span>
<span>  G.param <span class="op">=</span> <span class="va">G</span></span>
<span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>ASReml Version 4.2 08/10/2024 11:28:48
          LogLik        Sigma2     DF     wall
 1     -2474.972           1.0   1807   11:28:49  (  3 restrained)
 2     -2406.283           1.0   1807   11:28:49
 3     -2394.010           1.0   1807   11:28:49
 4     -2391.718           1.0   1807   11:28:49
 5     -2391.480           1.0   1807   11:28:49
 6     -2391.477           1.0   1807   11:28:49</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in asreml(fixed = cbind(bwt, tarsus) ~ trait + at(trait):sex, random =
~at(sex):us(trait, : Warning : US updates modified 1 times in iteration 1 to
remain positive definite.</code></pre>
</div>
<div class="sourceCode" id="cb132"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">reduc.model_sex</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/update.html">update</a></span><span class="op">(</span><span class="va">reduc.model_sex</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>ASReml Version 4.2 08/10/2024 11:28:49
          LogLik        Sigma2     DF     wall
 1     -2391.476           1.0   1807   11:28:49
 2     -2391.476           1.0   1807   11:28:49</code></pre>
</div>
<div class="sourceCode" id="cb134"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">reduc.model_sex</span><span class="op">)</span><span class="op">$</span><span class="va">varcomp</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                                                         component std.error
trait:byear!trait_bwt:bwt                                0.9794331 0.2848997
trait:byear!trait_tarsus:bwt                             0.1428995 0.4322719
trait:byear!trait_tarsus:tarsus                          4.0021595 1.2818624
trait:mother!trait_bwt:bwt                               1.4956509 0.2568074
trait:mother!trait_tarsus:bwt                           -1.2460057 0.4438357
trait:mother!trait_tarsus:tarsus                         5.3945609 1.4035705
at(sex, '1'):trait:vm(animal, ainv)!trait_bwt:bwt        0.5265716 0.3579555
at(sex, '1'):trait:vm(animal, ainv)!trait_tarsus:bwt     0.0000000        NA
at(sex, '1'):trait:vm(animal, ainv)!trait_tarsus:tarsus  1.4223969 1.9103795
at(sex, '2'):trait:vm(animal, ainv)!trait_bwt:bwt        1.5835813 0.8671365
at(sex, '2'):trait:vm(animal, ainv)!trait_tarsus:bwt     4.4288714 2.0173971
at(sex, '2'):trait:vm(animal, ainv)!trait_tarsus:tarsus 12.9349047 6.2946996
sex_1!R                                                  1.0000000        NA
sex_1!trait_bwt:bwt                                      2.9539767 0.4196755
sex_1!trait_tarsus:bwt                                   6.3138301 0.6802598
sex_1!trait_tarsus:tarsus                               17.3577089 2.4730547
sex_2!R                                                  1.0000000        NA
sex_2!trait_bwt:bwt                                      1.9341439 0.7416691
sex_2!trait_tarsus:bwt                                   2.9467290 1.7370018
sex_2!trait_tarsus:tarsus                               10.7245912 5.4025888
                                                           z.ratio bound %ch
trait:byear!trait_bwt:bwt                                3.4378175     P   0
trait:byear!trait_tarsus:bwt                             0.3305778     P   0
trait:byear!trait_tarsus:tarsus                          3.1221444     P   0
trait:mother!trait_bwt:bwt                               5.8240170     P   0
trait:mother!trait_tarsus:bwt                           -2.8073580     P   0
trait:mother!trait_tarsus:tarsus                         3.8434556     P   0
at(sex, '1'):trait:vm(animal, ainv)!trait_bwt:bwt        1.4710530     P   0
at(sex, '1'):trait:vm(animal, ainv)!trait_tarsus:bwt            NA     F  NA
at(sex, '1'):trait:vm(animal, ainv)!trait_tarsus:tarsus  0.7445625     P   0
at(sex, '2'):trait:vm(animal, ainv)!trait_bwt:bwt        1.8262193     P   0
at(sex, '2'):trait:vm(animal, ainv)!trait_tarsus:bwt     2.1953395     P   0
at(sex, '2'):trait:vm(animal, ainv)!trait_tarsus:tarsus  2.0548883     P   0
sex_1!R                                                         NA     F   0
sex_1!trait_bwt:bwt                                      7.0387165     P   0
sex_1!trait_tarsus:bwt                                   9.2814981     P   0
sex_1!trait_tarsus:tarsus                                7.0187323     P   0
sex_2!R                                                         NA     F   0
sex_2!trait_bwt:bwt                                      2.6078261     P   0
sex_2!trait_tarsus:bwt                                   1.6964455     P   0
sex_2!trait_tarsus:tarsus                                1.9850837     P   0</code></pre>
</div>
<div class="sourceCode" id="cb136"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fl">2</span> <span class="op">*</span> <span class="op">(</span><span class="va">model_sex</span><span class="op">$</span><span class="va">loglik</span> <span class="op">-</span> <span class="va">reduc.model_sex</span><span class="op">$</span><span class="va">loglik</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 5.481033</code></pre>
</div>
<div class="sourceCode" id="cb138"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fl">1</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Chisquare.html">pchisq</a></span><span class="op">(</span><span class="fl">2</span> <span class="op">*</span> <span class="op">(</span><span class="va">model_sex</span><span class="op">$</span><span class="va">loglik</span> <span class="op">-</span> <span class="va">reduc.model_sex</span><span class="op">$</span><span class="va">loglik</span><span class="op">)</span>, df <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.0192239</code></pre>
</div>
</div>
<p>In addition, it is also possible to test the sexesif sexes has significant differences with another reduced model where both covariance are fixed to their average values.</p>
<!-- Issue with this model!!!  my code should be ok !-->
<div class="cell">
<div class="sourceCode" id="cb140"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># code provided as an example for the moment since the model cannot run on this data</span></span>
<span><span class="va">model_modif</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/asreml/man/update.asreml.html">update.asreml</a></span><span class="op">(</span><span class="va">model_sex</span>, start.values <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></span>
<span><span class="va">G</span> <span class="op">&lt;-</span> <span class="va">model_modif</span><span class="op">$</span><span class="va">vparameters</span><span class="op">[</span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">12</span><span class="op">)</span>, <span class="op">]</span></span>
<span><span class="va">G</span><span class="op">$</span><span class="va">fac</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span></span>
<span>    <span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">3</span>, <span class="fl">4</span>, <span class="fl">2</span>, <span class="fl">6</span>, <span class="co"># Additive genetic matrix  2 =5</span></span>
<span>    <span class="fl">7</span>, <span class="fl">8</span>, <span class="fl">9</span>, <span class="co"># byear  matrix</span></span>
<span>    <span class="fl">10</span>, <span class="fl">11</span>, <span class="fl">12</span> <span class="co"># mother matrix</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="va">Modif</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/asreml/man/vcm.lm.html">vcm.lm</a></span><span class="op">(</span><span class="op">~</span><span class="va">fac</span>, data <span class="op">=</span> <span class="va">G</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/attr.html">attr</a></span><span class="op">(</span><span class="va">Modif</span>, <span class="st">"assign"</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="cn">NULL</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/attr.html">attr</a></span><span class="op">(</span><span class="va">Modif</span>, <span class="st">"contrasts"</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="cn">NULL</span></span>
<span><span class="co">#</span></span>
<span><span class="va">reduc.model_sex_2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/asreml/man/asreml.html">asreml</a></span><span class="op">(</span></span>
<span>  fixed <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="va">bwt</span>, <span class="va">tarsus</span><span class="op">)</span> <span class="op">~</span> <span class="va">trait</span> <span class="op">+</span> <span class="fu">at</span><span class="op">(</span><span class="va">trait</span><span class="op">)</span><span class="op">:</span><span class="va">sex</span>,</span>
<span>  random <span class="op">=</span> <span class="op">~</span> <span class="fu">at</span><span class="op">(</span><span class="va">sex</span><span class="op">)</span><span class="op">:</span><span class="fu">us</span><span class="op">(</span><span class="va">trait</span>, init <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0.1</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op">:</span><span class="fu">vm</span><span class="op">(</span><span class="va">animal</span>, <span class="va">ainv</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">us</span><span class="op">(</span><span class="va">trait</span>, init <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0.1</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op">:</span><span class="va">byear</span> <span class="op">+</span></span>
<span>    <span class="fu">us</span><span class="op">(</span><span class="va">trait</span>, init <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0.1</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op">:</span><span class="va">mother</span>,</span>
<span>  residual <span class="op">=</span> <span class="op">~</span> <span class="fu">dsum</span><span class="op">(</span><span class="op">~</span> <span class="fu">id</span><span class="op">(</span><span class="va">units</span><span class="op">)</span><span class="op">:</span><span class="fu">us</span><span class="op">(</span><span class="va">trait</span><span class="op">)</span> <span class="op">|</span> <span class="va">sex</span><span class="op">)</span>,</span>
<span>  data <span class="op">=</span> <span class="va">gryphon</span>,</span>
<span>  na.action <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/asreml/man/na.method.html">na.method</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"include"</span>, y <span class="op">=</span> <span class="st">"include"</span><span class="op">)</span>,</span>
<span>  maxit <span class="op">=</span> <span class="fl">20</span>,</span>
<span>  G.param <span class="op">=</span> <span class="va">G</span>, vcm <span class="op">=</span> <span class="va">Modif</span></span>
<span><span class="op">)</span></span>
<span><span class="va">reduc.model_sex_2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/update.html">update</a></span><span class="op">(</span><span class="va">reduc.model_sex_2</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">reduc.model_sex_2</span><span class="op">)</span><span class="op">$</span><span class="va">varcomp</span></span>
<span></span>
<span></span>
<span></span>
<span><span class="fl">2</span> <span class="op">*</span> <span class="op">(</span><span class="va">model_sex</span><span class="op">$</span><span class="va">loglik</span> <span class="op">-</span> <span class="va">reduc.model_sex_2</span><span class="op">$</span><span class="va">loglik</span><span class="op">)</span></span>
<span><span class="fl">1</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Chisquare.html">pchisq</a></span><span class="op">(</span><span class="fl">2</span> <span class="op">*</span> <span class="op">(</span><span class="va">model_sex</span><span class="op">$</span><span class="va">loglik</span> <span class="op">-</span> <span class="va">reduc.model_sex_2</span><span class="op">$</span><span class="va">loglik</span><span class="op">)</span>, df <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Here a plot to visualize the overlaps of covariances.</p>
<div class="cell">
<div class="sourceCode" id="cb141"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">genetic.correlation.F</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/asreml/man/vpredict.html">vpredict</a></span><span class="op">(</span><span class="va">model_sex</span>, <span class="va">r_A.1</span> <span class="op">~</span> <span class="va">V8</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span><span class="op">(</span><span class="va">V7</span> <span class="op">*</span> <span class="va">V9</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">genetic.correlation.M</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/asreml/man/vpredict.html">vpredict</a></span><span class="op">(</span><span class="va">model_sex</span>, <span class="va">r_A.2</span> <span class="op">~</span> <span class="va">V11</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span><span class="op">(</span><span class="va">V10</span> <span class="op">*</span> <span class="va">V12</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">residual.correlation.F</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/asreml/man/vpredict.html">vpredict</a></span><span class="op">(</span><span class="va">model_sex</span>, <span class="va">r_res.1</span> <span class="op">~</span> <span class="va">V15</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span><span class="op">(</span><span class="va">V14</span> <span class="op">*</span> <span class="va">V16</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">residual.correlation.M</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/asreml/man/vpredict.html">vpredict</a></span><span class="op">(</span><span class="va">model_sex</span>, <span class="va">r_res.2</span> <span class="op">~</span> <span class="va">V19</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span><span class="op">(</span><span class="va">V18</span> <span class="op">*</span> <span class="va">V20</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">cor.est</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span><span class="op">(</span><span class="va">genetic.correlation.F</span>, <span class="va">genetic.correlation.M</span>, <span class="va">residual.correlation.F</span>, <span class="va">residual.correlation.M</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.95</span>, <span class="fl">1.05</span>, <span class="fl">1.95</span>, <span class="fl">2.05</span><span class="op">)</span> <span class="op">~</span> <span class="va">cor.est</span><span class="op">[</span>, <span class="fl">1</span><span class="op">]</span>, xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1.5</span><span class="op">)</span>, ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.5</span>, <span class="fl">2.5</span><span class="op">)</span>, xlab <span class="op">=</span> <span class="st">""</span>, ylab <span class="op">=</span> <span class="st">""</span>, col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"red"</span>, <span class="st">"blue"</span><span class="op">)</span>, pch <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">16</span>, <span class="fl">17</span><span class="op">)</span>, cex <span class="op">=</span> <span class="fl">2</span>, yaxt <span class="op">=</span> <span class="st">"n"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/arrows.html">arrows</a></span><span class="op">(</span>y0 <span class="op">=</span> <span class="fl">0.95</span>, x0 <span class="op">=</span> <span class="va">cor.est</span><span class="op">[</span><span class="fl">1</span>, <span class="fl">1</span><span class="op">]</span> <span class="op">-</span> <span class="va">cor.est</span><span class="op">[</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">]</span>, y1 <span class="op">=</span> <span class="fl">0.95</span>, x1 <span class="op">=</span> <span class="va">cor.est</span><span class="op">[</span><span class="fl">1</span>, <span class="fl">1</span><span class="op">]</span> <span class="op">+</span> <span class="va">cor.est</span><span class="op">[</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">]</span>, code <span class="op">=</span> <span class="fl">3</span>, angle <span class="op">=</span> <span class="fl">90</span>, length <span class="op">=</span> <span class="fl">0</span>, col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"red"</span><span class="op">)</span>, lwd <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/arrows.html">arrows</a></span><span class="op">(</span>y0 <span class="op">=</span> <span class="fl">1.05</span>, x0 <span class="op">=</span> <span class="va">cor.est</span><span class="op">[</span><span class="fl">2</span>, <span class="fl">1</span><span class="op">]</span> <span class="op">-</span> <span class="va">cor.est</span><span class="op">[</span><span class="fl">2</span>, <span class="fl">2</span><span class="op">]</span>, y1 <span class="op">=</span> <span class="fl">1.05</span>, x1 <span class="op">=</span> <span class="va">cor.est</span><span class="op">[</span><span class="fl">2</span>, <span class="fl">1</span><span class="op">]</span> <span class="op">+</span> <span class="va">cor.est</span><span class="op">[</span><span class="fl">2</span>, <span class="fl">2</span><span class="op">]</span>, code <span class="op">=</span> <span class="fl">3</span>, angle <span class="op">=</span> <span class="fl">90</span>, length <span class="op">=</span> <span class="fl">0</span>, col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"blue"</span><span class="op">)</span>, lwd <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/arrows.html">arrows</a></span><span class="op">(</span>y0 <span class="op">=</span> <span class="fl">1.95</span>, x0 <span class="op">=</span> <span class="va">cor.est</span><span class="op">[</span><span class="fl">3</span>, <span class="fl">1</span><span class="op">]</span> <span class="op">-</span> <span class="va">cor.est</span><span class="op">[</span><span class="fl">3</span>, <span class="fl">2</span><span class="op">]</span>, y1 <span class="op">=</span> <span class="fl">1.95</span>, x1 <span class="op">=</span> <span class="va">cor.est</span><span class="op">[</span><span class="fl">3</span>, <span class="fl">1</span><span class="op">]</span> <span class="op">+</span> <span class="va">cor.est</span><span class="op">[</span><span class="fl">3</span>, <span class="fl">2</span><span class="op">]</span>, code <span class="op">=</span> <span class="fl">3</span>, angle <span class="op">=</span> <span class="fl">90</span>, length <span class="op">=</span> <span class="fl">0</span>, col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"red"</span><span class="op">)</span>, lwd <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/arrows.html">arrows</a></span><span class="op">(</span>y0 <span class="op">=</span> <span class="fl">2.05</span>, x0 <span class="op">=</span> <span class="va">cor.est</span><span class="op">[</span><span class="fl">4</span>, <span class="fl">1</span><span class="op">]</span> <span class="op">-</span> <span class="va">cor.est</span><span class="op">[</span><span class="fl">4</span>, <span class="fl">2</span><span class="op">]</span>, y1 <span class="op">=</span> <span class="fl">2.05</span>, x1 <span class="op">=</span> <span class="va">cor.est</span><span class="op">[</span><span class="fl">4</span>, <span class="fl">1</span><span class="op">]</span> <span class="op">+</span> <span class="va">cor.est</span><span class="op">[</span><span class="fl">4</span>, <span class="fl">2</span><span class="op">]</span>, code <span class="op">=</span> <span class="fl">3</span>, angle <span class="op">=</span> <span class="fl">90</span>, length <span class="op">=</span> <span class="fl">0</span>, col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"blue"</span><span class="op">)</span>, lwd <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/mtext.html">mtext</a></span><span class="op">(</span><span class="st">"Correlation (±CI)"</span>, side <span class="op">=</span> <span class="fl">1</span>, las <span class="op">=</span> <span class="fl">1</span>, adj <span class="op">=</span> <span class="fl">0.4</span>, line <span class="op">=</span> <span class="fl">3</span>, cex <span class="op">=</span> <span class="fl">1.6</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/axis.html">axis</a></span><span class="op">(</span><span class="fl">2</span>, at <span class="op">=</span> <span class="fl">1</span>, labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"genetic"</span><span class="op">)</span>, las <span class="op">=</span> <span class="fl">3</span>, cex.axis <span class="op">=</span> <span class="fl">1.6</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/axis.html">axis</a></span><span class="op">(</span><span class="fl">2</span>, at <span class="op">=</span> <span class="fl">2</span>, labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"residual"</span><span class="op">)</span>, las <span class="op">=</span> <span class="fl">3</span>, cex.axis <span class="op">=</span> <span class="fl">1.6</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="03_01-biv_asreml_files/figure-html/unnamed-chunk-33-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>By using <code>corgh</code>, we can extract the BLUPs and plot the sex-specific correlation.</p>
<div class="cell">
<div class="sourceCode" id="cb142"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">gryphon</span><span class="op">$</span><span class="va">T1</span> <span class="op">&lt;-</span> <span class="va">gryphon</span><span class="op">$</span><span class="va">bwt</span></span>
<span><span class="va">gryphon</span><span class="op">$</span><span class="va">T2</span> <span class="op">&lt;-</span> <span class="va">gryphon</span><span class="op">$</span><span class="va">tarsus</span></span>
<span><span class="co">###</span></span>
<span><span class="va">model_sex</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/asreml/man/asreml.html">asreml</a></span><span class="op">(</span></span>
<span>  fixed <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="va">T1</span>, <span class="va">T2</span><span class="op">)</span> <span class="op">~</span> <span class="va">trait</span> <span class="op">+</span> <span class="fu">at</span><span class="op">(</span><span class="va">trait</span><span class="op">)</span><span class="op">:</span><span class="va">sex</span>,</span>
<span>  random <span class="op">=</span> <span class="op">~</span> <span class="fu">at</span><span class="op">(</span><span class="va">sex</span><span class="op">)</span><span class="op">:</span><span class="fu">corgh</span><span class="op">(</span><span class="va">trait</span>, init <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.1</span>, <span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op">:</span><span class="fu">vm</span><span class="op">(</span><span class="va">animal</span>, <span class="va">ainv</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu">us</span><span class="op">(</span><span class="va">trait</span>, init <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0.1</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op">:</span><span class="va">byear</span> <span class="op">+</span></span>
<span>    <span class="fu">us</span><span class="op">(</span><span class="va">trait</span>, init <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0.1</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op">:</span><span class="va">mother</span>,</span>
<span>  residual <span class="op">=</span> <span class="op">~</span> <span class="fu">dsum</span><span class="op">(</span><span class="op">~</span> <span class="fu">id</span><span class="op">(</span><span class="va">units</span><span class="op">)</span><span class="op">:</span><span class="fu">us</span><span class="op">(</span><span class="va">trait</span><span class="op">)</span> <span class="op">|</span> <span class="va">sex</span><span class="op">)</span>,</span>
<span>  data <span class="op">=</span> <span class="va">gryphon</span>,</span>
<span>  na.action <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/asreml/man/na.method.html">na.method</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"include"</span>, y <span class="op">=</span> <span class="st">"include"</span><span class="op">)</span>,</span>
<span>  maxit <span class="op">=</span> <span class="fl">20</span></span>
<span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>ASReml Version 4.2 08/10/2024 11:28:49
          LogLik        Sigma2     DF     wall
 1     -2522.729           1.0   1807   11:28:50  (  2 restrained)
 2     -2457.755           1.0   1807   11:28:50  (  2 restrained)
 3     -2407.462           1.0   1807   11:28:50  (  2 restrained)
 4     -2394.143           1.0   1807   11:28:50  (  1 restrained)
 5     -2389.368           1.0   1807   11:28:50
 6     -2388.741           1.0   1807   11:28:50
 7     -2388.736           1.0   1807   11:28:50</code></pre>
</div>
<div class="sourceCode" id="cb144"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">model_sex</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/update.html">update</a></span><span class="op">(</span><span class="va">model_sex</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>ASReml Version 4.2 08/10/2024 11:28:50
          LogLik        Sigma2     DF     wall
 1     -2388.736           1.0   1807   11:28:50
 2     -2388.736           1.0   1807   11:28:50</code></pre>
</div>
<div class="sourceCode" id="cb146"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">DvsS</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span></span>
<span>  Trait <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span><span class="op">(</span><span class="va">model_sex</span><span class="op">$</span><span class="va">coefficients</span><span class="op">$</span><span class="va">random</span><span class="op">)</span>,</span>
<span>  BLUP <span class="op">=</span> <span class="va">model_sex</span><span class="op">$</span><span class="va">coefficients</span><span class="op">$</span><span class="va">random</span>,</span>
<span>  SE <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span><span class="op">(</span><span class="va">model_sex</span><span class="op">$</span><span class="va">vcoeff</span><span class="op">$</span><span class="va">random</span> <span class="op">*</span> <span class="va">model_sex</span><span class="op">$</span><span class="va">sigma2</span><span class="op">)</span></span>
<span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html">grepl</a></span><span class="op">(</span><span class="st">"at\\(sex"</span>, <span class="va">Trait</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span></span>
<span>    ID <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/substr.html">substr</a></span><span class="op">(</span><span class="va">Trait</span>, <span class="fl">40</span>, <span class="fl">44</span><span class="op">)</span>,</span>
<span>    TRAIT <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/substr.html">substr</a></span><span class="op">(</span><span class="va">Trait</span>, <span class="fl">20</span>, <span class="fl">21</span><span class="op">)</span>,</span>
<span>    SEX <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/substr.html">substr</a></span><span class="op">(</span><span class="va">Trait</span>, <span class="fl">10</span>, <span class="fl">10</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">rename</span><span class="op">(</span></span>
<span>    BLUP <span class="op">=</span> <span class="st">"effect"</span></span>
<span>  <span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">select</span><span class="op">(</span><span class="va">BLUP</span><span class="op">:</span><span class="va">SEX</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">DvsS</span><span class="op">$</span><span class="va">TRAIT</span><span class="op">)</span><span class="op">)</span> <span class="co"># 1309 each</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  T1   T2 
2618 2618 </code></pre>
</div>
<div class="sourceCode" id="cb148"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co">#</span></span>
<span></span>
<span><span class="va">BLUPS</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/reshape.html">reshape</a></span><span class="op">(</span><span class="va">DvsS</span>, v.names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"BLUP"</span>, <span class="st">"SE"</span><span class="op">)</span>, idvar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"ID"</span>, <span class="st">"SEX"</span><span class="op">)</span>, timevar <span class="op">=</span> <span class="st">"TRAIT"</span>, direction <span class="op">=</span> <span class="st">"wide"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">BLUPS</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 2618</code></pre>
</div>
<div class="sourceCode" id="cb150"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span><span class="op">(</span><span class="va">BLUPS</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">BLUPS</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"ID"</span>, <span class="st">"SEX"</span>, <span class="st">"BLUP.btw"</span>, <span class="st">"SE.btw"</span>, <span class="st">"BLUP.tarsus"</span>, <span class="st">"SE.tarsus"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">BLUPS</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>      ID                SEX               BLUP.btw             SE.btw      
 Length:2618        Length:2618        Min.   :-2.669649   Min.   :0.8383  
 Class :character   Class :character   1st Qu.:-0.281979   1st Qu.:0.9366  
 Mode  :character   Mode  :character   Median : 0.000000   Median :1.1001  
                                       Mean   : 0.009574   Mean   :1.0913  
                                       3rd Qu.: 0.295795   3rd Qu.:1.1780  
                                       Max.   : 2.895393   Max.   :1.4276  
  BLUP.tarsus         SE.tarsus    
 Min.   :-7.81574   Min.   :1.829  
 1st Qu.:-0.64388   1st Qu.:2.342  
 Median : 0.00000   Median :2.462  
 Mean   : 0.03319   Mean   :2.728  
 3rd Qu.: 0.74473   3rd Qu.:3.329  
 Max.   : 8.77778   Max.   :4.038  </code></pre>
</div>
<div class="sourceCode" id="cb152"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># write.csv(BLUPS,file="BLUPS_6x6_SEX.csv",row.names=F)</span></span>
<span><span class="co">############</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span><span class="op">(</span>mfrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/hist.html">hist</a></span><span class="op">(</span><span class="va">BLUPS</span><span class="op">$</span><span class="va">BLUP.btw</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/qqnorm.html">qqnorm</a></span><span class="op">(</span><span class="va">BLUPS</span><span class="op">$</span><span class="va">BLUP.btw</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/qqnorm.html">qqline</a></span><span class="op">(</span><span class="va">BLUPS</span><span class="op">$</span><span class="va">BLUP.btw</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/hist.html">hist</a></span><span class="op">(</span><span class="va">BLUPS</span><span class="op">$</span><span class="va">BLUP.tarsus</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/qqnorm.html">qqnorm</a></span><span class="op">(</span><span class="va">BLUPS</span><span class="op">$</span><span class="va">BLUP.tarsus</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/qqnorm.html">qqline</a></span><span class="op">(</span><span class="va">BLUPS</span><span class="op">$</span><span class="va">BLUP.tarsus</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="03_01-biv_asreml_files/figure-html/unnamed-chunk-34-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Here, some simple codes to plot the genetic correlation.</p>
<div class="cell">
<div class="sourceCode" id="cb153"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">FEM</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span><span class="va">BLUPS</span>, <span class="va">SEX</span> <span class="op">==</span> <span class="st">"1"</span><span class="op">)</span></span>
<span><span class="va">MAL</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span><span class="va">BLUPS</span>, <span class="va">SEX</span> <span class="op">==</span> <span class="st">"2"</span><span class="op">)</span></span>
<span><span class="co">#</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span><span class="op">(</span>mfrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">BLUP.tarsus</span> <span class="op">~</span> <span class="va">BLUP.btw</span>, <span class="va">FEM</span>, xlab <span class="op">=</span> <span class="st">""</span>, ylab <span class="op">=</span> <span class="st">""</span>, las <span class="op">=</span> <span class="fl">1.2</span>, bty <span class="op">=</span> <span class="st">"o"</span>, col <span class="op">=</span> <span class="st">"white"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/arrows.html">arrows</a></span><span class="op">(</span>x0 <span class="op">=</span> <span class="va">FEM</span><span class="op">$</span><span class="va">BLUP.btw</span>, y0 <span class="op">=</span> <span class="va">FEM</span><span class="op">$</span><span class="va">BLUP.tarsus</span> <span class="op">-</span> <span class="va">FEM</span><span class="op">$</span><span class="va">SE.tarsus</span>, x1 <span class="op">=</span> <span class="va">FEM</span><span class="op">$</span><span class="va">BLUP.btw</span>, y1 <span class="op">=</span> <span class="va">FEM</span><span class="op">$</span><span class="va">BLUP.tarsus</span> <span class="op">+</span> <span class="va">FEM</span><span class="op">$</span><span class="va">SE.tarsus</span>, col <span class="op">=</span> <span class="st">"black"</span>, code <span class="op">=</span> <span class="fl">3</span>, angle <span class="op">=</span> <span class="fl">90</span>, length <span class="op">=</span> <span class="fl">0</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/arrows.html">arrows</a></span><span class="op">(</span>x0 <span class="op">=</span> <span class="va">FEM</span><span class="op">$</span><span class="va">BLUP.btw</span> <span class="op">-</span> <span class="va">FEM</span><span class="op">$</span><span class="va">SE.btw</span>, y0 <span class="op">=</span> <span class="va">FEM</span><span class="op">$</span><span class="va">BLUP.tarsus</span>, x1 <span class="op">=</span> <span class="va">FEM</span><span class="op">$</span><span class="va">BLUP.btw</span> <span class="op">+</span> <span class="va">FEM</span><span class="op">$</span><span class="va">SE.btw</span>, y1 <span class="op">=</span> <span class="va">FEM</span><span class="op">$</span><span class="va">BLUP.tarsus</span>, col <span class="op">=</span> <span class="st">"black"</span>, code <span class="op">=</span> <span class="fl">3</span>, angle <span class="op">=</span> <span class="fl">90</span>, length <span class="op">=</span> <span class="fl">0</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/points.html">points</a></span><span class="op">(</span><span class="va">BLUP.tarsus</span> <span class="op">~</span> <span class="va">BLUP.btw</span>, <span class="va">FEM</span>, pch <span class="op">=</span> <span class="fl">16</span>, col <span class="op">=</span> <span class="st">"red"</span>, cex <span class="op">=</span> <span class="fl">1.5</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/points.html">points</a></span><span class="op">(</span><span class="va">BLUP.tarsus</span> <span class="op">~</span> <span class="va">BLUP.btw</span>, <span class="va">FEM</span>, pch <span class="op">=</span> <span class="fl">1</span>, col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grDevices/rgb.html">rgb</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0.3</span><span class="op">)</span>, cex <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1.5</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/mtext.html">mtext</a></span><span class="op">(</span><span class="st">"btw (BV±SE)"</span>, side <span class="op">=</span> <span class="fl">1</span>, line <span class="op">=</span> <span class="fl">2.4</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/mtext.html">mtext</a></span><span class="op">(</span><span class="st">"tarsus (BV±SE)"</span>, side <span class="op">=</span> <span class="fl">2</span>, line <span class="op">=</span> <span class="fl">2</span>, las <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span>
<span><span class="co">#</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">BLUP.tarsus</span> <span class="op">~</span> <span class="va">BLUP.btw</span>, <span class="va">MAL</span>, xlab <span class="op">=</span> <span class="st">""</span>, ylab <span class="op">=</span> <span class="st">""</span>, las <span class="op">=</span> <span class="fl">1.2</span>, bty <span class="op">=</span> <span class="st">"o"</span>, col <span class="op">=</span> <span class="st">"white"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/arrows.html">arrows</a></span><span class="op">(</span>x0 <span class="op">=</span> <span class="va">MAL</span><span class="op">$</span><span class="va">BLUP.btw</span>, y0 <span class="op">=</span> <span class="va">MAL</span><span class="op">$</span><span class="va">BLUP.tarsus</span> <span class="op">-</span> <span class="va">MAL</span><span class="op">$</span><span class="va">SE.tarsus</span>, x1 <span class="op">=</span> <span class="va">MAL</span><span class="op">$</span><span class="va">BLUP.btw</span>, y1 <span class="op">=</span> <span class="va">MAL</span><span class="op">$</span><span class="va">BLUP.tarsus</span> <span class="op">+</span> <span class="va">MAL</span><span class="op">$</span><span class="va">SE.tarsus</span>, col <span class="op">=</span> <span class="st">"black"</span>, code <span class="op">=</span> <span class="fl">3</span>, angle <span class="op">=</span> <span class="fl">90</span>, length <span class="op">=</span> <span class="fl">0</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/arrows.html">arrows</a></span><span class="op">(</span>x0 <span class="op">=</span> <span class="va">MAL</span><span class="op">$</span><span class="va">BLUP.btw</span> <span class="op">-</span> <span class="va">MAL</span><span class="op">$</span><span class="va">SE.btw</span>, y0 <span class="op">=</span> <span class="va">MAL</span><span class="op">$</span><span class="va">BLUP.tarsus</span>, x1 <span class="op">=</span> <span class="va">MAL</span><span class="op">$</span><span class="va">BLUP.btw</span> <span class="op">+</span> <span class="va">MAL</span><span class="op">$</span><span class="va">SE.btw</span>, y1 <span class="op">=</span> <span class="va">MAL</span><span class="op">$</span><span class="va">BLUP.tarsus</span>, col <span class="op">=</span> <span class="st">"black"</span>, code <span class="op">=</span> <span class="fl">3</span>, angle <span class="op">=</span> <span class="fl">90</span>, length <span class="op">=</span> <span class="fl">0</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/points.html">points</a></span><span class="op">(</span><span class="va">BLUP.tarsus</span> <span class="op">~</span> <span class="va">BLUP.btw</span>, <span class="va">MAL</span>, pch <span class="op">=</span> <span class="fl">16</span>, col <span class="op">=</span> <span class="st">"blue"</span>, cex <span class="op">=</span> <span class="fl">1.5</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/points.html">points</a></span><span class="op">(</span><span class="va">BLUP.tarsus</span> <span class="op">~</span> <span class="va">BLUP.btw</span>, <span class="va">MAL</span>, pch <span class="op">=</span> <span class="fl">1</span>, col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grDevices/rgb.html">rgb</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0.3</span><span class="op">)</span>, cex <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1.5</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/mtext.html">mtext</a></span><span class="op">(</span><span class="st">"btw (BV±SE)"</span>, side <span class="op">=</span> <span class="fl">1</span>, line <span class="op">=</span> <span class="fl">2.4</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/mtext.html">mtext</a></span><span class="op">(</span><span class="st">"tarsus (BV±SE)"</span>, side <span class="op">=</span> <span class="fl">2</span>, line <span class="op">=</span> <span class="fl">2</span>, las <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="03_01-biv_asreml_files/figure-html/unnamed-chunk-35-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section><section id="between-groups-covariances-and-the-b-matrix" class="level3" data-number="5.0.7"><h3 data-number="5.0.7" class="anchored" data-anchor-id="between-groups-covariances-and-the-b-matrix">
<span class="header-section-number">5.0.7</span> Between groups (co)variances and the B-matrix</h3>
<p>Animal models are amazing model. With different group within a population, it is also possible to estimate how much the different groups shared the same genetic via the cross-group genetic covariance. This covariance is essential to understand ontogenic or sexual conflict, which can constraint or enhanced response to evolution. As an example, we estimate the cross-sex genetic correlation <code>r_{fm}</code></p>
<p>First, we need to dissociate the trait values for females and males into distinct variables. Then, we use a bivariate model (for one trait: <code>tarsus</code>) and a multivariate model (for various traits: <code>tarsus</code> and <code>bwt</code>). With a multivariate model, the cross-sex-cross trait covariance matrixis also named <code>B matrix</code>.</p>
<p>The coding is a bit complex but pretty straightforward. It is important to modify the covariance matrix at the residual level to avoid the calculation of a cross-sex residual covariance (no individual switched sex during the experiment).</p>
<div class="cell">
<div class="sourceCode" id="cb154"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">gryphon</span><span class="op">$</span><span class="va">bwt.1</span> <span class="op">&lt;-</span> <span class="cn">NA</span></span>
<span><span class="va">gryphon</span><span class="op">$</span><span class="va">tarsus.1</span> <span class="op">&lt;-</span> <span class="cn">NA</span></span>
<span><span class="va">animal</span> <span class="op">&lt;-</span> <span class="va">gryphon</span><span class="op">[</span><span class="va">gryphon</span><span class="op">$</span><span class="va">sex</span> <span class="op">==</span> <span class="st">"1"</span>, <span class="op">]</span><span class="op">$</span><span class="va">animal</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="va">animal</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">gryphon</span><span class="op">$</span><span class="va">bwt.1</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="va">gryphon</span><span class="op">$</span><span class="va">animal</span> <span class="op">==</span> <span class="va">i</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">gryphon</span><span class="op">$</span><span class="va">bwt</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="va">gryphon</span><span class="op">$</span><span class="va">animal</span> <span class="op">==</span> <span class="va">i</span><span class="op">)</span><span class="op">]</span></span>
<span>  <span class="va">gryphon</span><span class="op">$</span><span class="va">tarsus.1</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="va">gryphon</span><span class="op">$</span><span class="va">animal</span> <span class="op">==</span> <span class="va">i</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">gryphon</span><span class="op">$</span><span class="va">tarsus</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="va">gryphon</span><span class="op">$</span><span class="va">animal</span> <span class="op">==</span> <span class="va">i</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="op">}</span></span>
<span><span class="co">#</span></span>
<span><span class="va">gryphon</span><span class="op">$</span><span class="va">bwt.2</span> <span class="op">&lt;-</span> <span class="cn">NA</span></span>
<span><span class="va">gryphon</span><span class="op">$</span><span class="va">tarsus.2</span> <span class="op">&lt;-</span> <span class="cn">NA</span></span>
<span><span class="va">animal</span> <span class="op">&lt;-</span> <span class="va">gryphon</span><span class="op">[</span><span class="va">gryphon</span><span class="op">$</span><span class="va">sex</span> <span class="op">==</span> <span class="st">"2"</span>, <span class="op">]</span><span class="op">$</span><span class="va">animal</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="va">animal</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">gryphon</span><span class="op">$</span><span class="va">bwt.2</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="va">gryphon</span><span class="op">$</span><span class="va">animal</span> <span class="op">==</span> <span class="va">i</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">gryphon</span><span class="op">$</span><span class="va">bwt</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="va">gryphon</span><span class="op">$</span><span class="va">animal</span> <span class="op">==</span> <span class="va">i</span><span class="op">)</span><span class="op">]</span></span>
<span>  <span class="va">gryphon</span><span class="op">$</span><span class="va">tarsus.2</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="va">gryphon</span><span class="op">$</span><span class="va">animal</span> <span class="op">==</span> <span class="va">i</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">gryphon</span><span class="op">$</span><span class="va">tarsus</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="va">gryphon</span><span class="op">$</span><span class="va">animal</span> <span class="op">==</span> <span class="va">i</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co">###########</span></span>
<span><span class="va">temp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/asreml/man/asreml.html">asreml</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="va">tarsus.1</span>, <span class="va">tarsus.2</span><span class="op">)</span> <span class="op">~</span> <span class="va">trait</span>,</span>
<span>  random <span class="op">=</span> <span class="op">~</span> <span class="fu">us</span><span class="op">(</span><span class="va">trait</span><span class="op">)</span><span class="op">:</span><span class="fu">vm</span><span class="op">(</span><span class="va">animal</span>, <span class="va">ainv</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/diag.html">diag</a></span><span class="op">(</span><span class="va">trait</span><span class="op">)</span><span class="op">:</span><span class="va">byear</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/diag.html">diag</a></span><span class="op">(</span><span class="va">trait</span><span class="op">)</span><span class="op">:</span><span class="va">mother</span>,</span>
<span>  residual <span class="op">=</span> <span class="op">~</span> <span class="va">units</span><span class="op">:</span><span class="fu">us</span><span class="op">(</span><span class="va">trait</span><span class="op">)</span>,</span>
<span>  data <span class="op">=</span> <span class="va">gryphon</span>, na.action <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/asreml/man/na.method.html">na.method</a></span><span class="op">(</span>y <span class="op">=</span> <span class="st">"include"</span>, x <span class="op">=</span> <span class="st">"include"</span><span class="op">)</span>, maxiter <span class="op">=</span> <span class="fl">20</span>,</span>
<span>  start.values <span class="op">=</span> <span class="cn">T</span></span>
<span><span class="op">)</span></span>
<span><span class="va">G</span> <span class="op">&lt;-</span> <span class="va">temp</span><span class="op">$</span><span class="va">vparameters</span><span class="op">[</span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">7</span><span class="op">)</span>, <span class="op">]</span></span>
<span><span class="va">R</span> <span class="op">&lt;-</span> <span class="va">temp</span><span class="op">$</span><span class="va">vparameters</span><span class="op">[</span><span class="op">-</span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">7</span><span class="op">)</span>, <span class="op">]</span></span>
<span><span class="co">#</span></span>
<span><span class="va">G</span><span class="op">$</span><span class="va">Constraint</span> <span class="op">&lt;-</span> <span class="st">"U"</span></span>
<span><span class="va">R</span><span class="op">$</span><span class="va">Value</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span><span class="va">R</span><span class="op">$</span><span class="va">Constraint</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"F"</span></span>
<span><span class="co">#</span></span>
<span><span class="va">model.BiV_Sex</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/asreml/man/asreml.html">asreml</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="va">tarsus.1</span>, <span class="va">tarsus.2</span><span class="op">)</span> <span class="op">~</span> <span class="va">trait</span>,</span>
<span>  random <span class="op">=</span> <span class="op">~</span> <span class="fu">us</span><span class="op">(</span><span class="va">trait</span><span class="op">)</span><span class="op">:</span><span class="fu">vm</span><span class="op">(</span><span class="va">animal</span>, <span class="va">ainv</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/diag.html">diag</a></span><span class="op">(</span><span class="va">trait</span><span class="op">)</span><span class="op">:</span><span class="va">byear</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/diag.html">diag</a></span><span class="op">(</span><span class="va">trait</span><span class="op">)</span><span class="op">:</span><span class="va">mother</span>,</span>
<span>  residual <span class="op">=</span> <span class="op">~</span> <span class="va">units</span><span class="op">:</span><span class="fu">us</span><span class="op">(</span><span class="va">trait</span><span class="op">)</span>,</span>
<span>  data <span class="op">=</span> <span class="va">gryphon</span>, na.action <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/asreml/man/na.method.html">na.method</a></span><span class="op">(</span>y <span class="op">=</span> <span class="st">"include"</span>, x <span class="op">=</span> <span class="st">"include"</span><span class="op">)</span>, maxiter <span class="op">=</span> <span class="fl">20</span>,</span>
<span>  G.param <span class="op">=</span> <span class="va">G</span>, R.param <span class="op">=</span> <span class="va">R</span></span>
<span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>ASReml Version 4.2 08/10/2024 11:28:52
          LogLik        Sigma2     DF     wall
 1     -1494.807           1.0    681   11:28:52  (  1 restrained)
 2     -1484.793           1.0    681   11:28:52  (  1 restrained)
 3     -1475.726           1.0    681   11:28:52  (  1 restrained)
 4     -1471.905           1.0    681   11:28:52  (  1 restrained)
 5     -1470.716           1.0    681   11:28:52
 6     -1468.154           1.0    681   11:28:52
 7     -1467.969           1.0    681   11:28:52
 8     -1467.967           1.0    681   11:28:52</code></pre>
</div>
<div class="sourceCode" id="cb156"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">model.BiV_Sex</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/asreml/man/update.asreml.html">update.asreml</a></span><span class="op">(</span><span class="va">model.BiV_Sex</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>ASReml Version 4.2 08/10/2024 11:28:52
          LogLik        Sigma2     DF     wall
 1     -1467.967           1.0    681   11:28:52
 2     -1467.967           1.0    681   11:28:52</code></pre>
</div>
<div class="sourceCode" id="cb158"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co">#</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">model.BiV_Sex</span><span class="op">)</span><span class="op">$</span><span class="va">varcomp</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                                               component std.error   z.ratio
trait:byear!trait_tarsus.1                      3.280319  1.532909 2.1399299
trait:byear!trait_tarsus.2                      4.743134  1.891252 2.5079332
trait:mother!trait_tarsus.1                     1.875132  2.424092 0.7735398
trait:mother!trait_tarsus.2                     4.314158  2.785254 1.5489283
trait:vm(animal, ainv)!trait_tarsus.1:tarsus.1  6.582654  3.636467 1.8101781
trait:vm(animal, ainv)!trait_tarsus.2:tarsus.1  8.396245  3.278591 2.5609306
trait:vm(animal, ainv)!trait_tarsus.2:tarsus.2 12.898424  8.038362 1.6046084
units:trait!R                                   1.000000        NA        NA
units:trait!trait_tarsus.1:tarsus.1            14.872757  3.637545 4.0886803
units:trait!trait_tarsus.2:tarsus.1             0.000000        NA        NA
units:trait!trait_tarsus.2:tarsus.2            10.760849  6.294585 1.7095406
                                               bound %ch
trait:byear!trait_tarsus.1                         U   0
trait:byear!trait_tarsus.2                         U   0
trait:mother!trait_tarsus.1                        U   0
trait:mother!trait_tarsus.2                        U   0
trait:vm(animal, ainv)!trait_tarsus.1:tarsus.1     U   0
trait:vm(animal, ainv)!trait_tarsus.2:tarsus.1     U   0
trait:vm(animal, ainv)!trait_tarsus.2:tarsus.2     U   0
units:trait!R                                      F   0
units:trait!trait_tarsus.1:tarsus.1                P   0
units:trait!trait_tarsus.2:tarsus.1                F  NA
units:trait!trait_tarsus.2:tarsus.2                P   0</code></pre>
</div>
</div>
<p>The cross-sex genetic correlation can estimate form the output of the model. For tarsus length at fledging, sexes shared a lot of genetic variance which is commun for a trait with low sexual dimorphism. If the selection is antagonistic between males and females, sexes can not evolve freely form the other sexes and a sexual conflict appears.</p>
<div class="cell">
<div class="sourceCode" id="cb160"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/asreml/man/vpredict.html">vpredict</a></span><span class="op">(</span><span class="va">model.BiV_Sex</span>, <span class="va">r_fm</span> <span class="op">~</span> <span class="va">V6</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span><span class="op">(</span><span class="va">V5</span> <span class="op">*</span> <span class="va">V7</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>      Estimate        SE
r_fm 0.9112054 0.4229764</code></pre>
</div>
</div>
<p>We can estimate directly the correlation and plot the cross-sex genetic correlation</p>
<div class="cell">
<div class="sourceCode" id="cb162"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">temp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/asreml/man/asreml.html">asreml</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="va">tarsus.1</span>, <span class="va">tarsus.2</span><span class="op">)</span> <span class="op">~</span> <span class="va">trait</span>,</span>
<span>  random <span class="op">=</span> <span class="op">~</span> <span class="fu">corgh</span><span class="op">(</span><span class="va">trait</span><span class="op">)</span><span class="op">:</span><span class="fu">vm</span><span class="op">(</span><span class="va">animal</span>, <span class="va">ainv</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/diag.html">diag</a></span><span class="op">(</span><span class="va">trait</span><span class="op">)</span><span class="op">:</span><span class="va">byear</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/diag.html">diag</a></span><span class="op">(</span><span class="va">trait</span><span class="op">)</span><span class="op">:</span><span class="va">mother</span>,</span>
<span>  residual <span class="op">=</span> <span class="op">~</span> <span class="va">units</span><span class="op">:</span><span class="fu">corgh</span><span class="op">(</span><span class="va">trait</span><span class="op">)</span>,</span>
<span>  data <span class="op">=</span> <span class="va">gryphon</span>, na.action <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/asreml/man/na.method.html">na.method</a></span><span class="op">(</span>y <span class="op">=</span> <span class="st">"include"</span>, x <span class="op">=</span> <span class="st">"include"</span><span class="op">)</span>, maxiter <span class="op">=</span> <span class="fl">20</span>,</span>
<span>  start.values <span class="op">=</span> <span class="cn">T</span></span>
<span><span class="op">)</span></span>
<span><span class="va">G</span> <span class="op">&lt;-</span> <span class="va">temp</span><span class="op">$</span><span class="va">vparameters</span><span class="op">[</span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">7</span><span class="op">)</span>, <span class="op">]</span></span>
<span><span class="va">R</span> <span class="op">&lt;-</span> <span class="va">temp</span><span class="op">$</span><span class="va">vparameters</span><span class="op">[</span><span class="op">-</span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">7</span><span class="op">)</span>, <span class="op">]</span></span>
<span><span class="co">#</span></span>
<span><span class="va">G</span><span class="op">$</span><span class="va">Constraint</span> <span class="op">&lt;-</span> <span class="st">"U"</span></span>
<span><span class="va">R</span><span class="op">$</span><span class="va">Value</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span><span class="va">R</span><span class="op">$</span><span class="va">Constraint</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"F"</span></span>
<span><span class="co">#</span></span>
<span><span class="va">model.BiV_Sex</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/asreml/man/asreml.html">asreml</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="va">tarsus.1</span>, <span class="va">tarsus.2</span><span class="op">)</span> <span class="op">~</span> <span class="va">trait</span>,</span>
<span>  random <span class="op">=</span> <span class="op">~</span> <span class="fu">corgh</span><span class="op">(</span><span class="va">trait</span><span class="op">)</span><span class="op">:</span><span class="fu">vm</span><span class="op">(</span><span class="va">animal</span>, <span class="va">ainv</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/diag.html">diag</a></span><span class="op">(</span><span class="va">trait</span><span class="op">)</span><span class="op">:</span><span class="va">byear</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/diag.html">diag</a></span><span class="op">(</span><span class="va">trait</span><span class="op">)</span><span class="op">:</span><span class="va">mother</span>,</span>
<span>  residual <span class="op">=</span> <span class="op">~</span> <span class="va">units</span><span class="op">:</span><span class="fu">corgh</span><span class="op">(</span><span class="va">trait</span><span class="op">)</span>,</span>
<span>  data <span class="op">=</span> <span class="va">gryphon</span>, na.action <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/asreml/man/na.method.html">na.method</a></span><span class="op">(</span>y <span class="op">=</span> <span class="st">"include"</span>, x <span class="op">=</span> <span class="st">"include"</span><span class="op">)</span>, maxiter <span class="op">=</span> <span class="fl">20</span>,</span>
<span>  G.param <span class="op">=</span> <span class="va">G</span>, R.param <span class="op">=</span> <span class="va">R</span></span>
<span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>ASReml Version 4.2 08/10/2024 11:28:52
          LogLik        Sigma2     DF     wall
 1     -1494.323           1.0    681   11:28:52  (  1 restrained)
 2     -1482.996           1.0    681   11:28:53  (  1 restrained)
 3     -1472.827           1.0    681   11:28:53  (  1 restrained)
 4     -1468.707           1.0    681   11:28:53
 5     -1467.984           1.0    681   11:28:53
 6     -1467.968           1.0    681   11:28:53
 7     -1467.967           1.0    681   11:28:53</code></pre>
</div>
<div class="sourceCode" id="cb164"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">model.BiV_Sex</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/asreml/man/update.asreml.html">update.asreml</a></span><span class="op">(</span><span class="va">model.BiV_Sex</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>ASReml Version 4.2 08/10/2024 11:28:53
          LogLik        Sigma2     DF     wall
 1     -1467.967           1.0    681   11:28:53
 2     -1467.967           1.0    681   11:28:53</code></pre>
</div>
<div class="sourceCode" id="cb166"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co">#</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">model.BiV_Sex</span><span class="op">)</span><span class="op">$</span><span class="va">varcomp</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                                                           component std.error
trait:byear!trait_tarsus.1                                 3.2803263 1.5329224
trait:byear!trait_tarsus.2                                 4.7431679 1.8913244
trait:mother!trait_tarsus.1                                1.8751274 2.4240942
trait:mother!trait_tarsus.2                                4.3141262 2.7852550
trait:vm(animal, ainv)!trait!tarsus.2:!trait!tarsus.1.cor  0.9111864 0.4230261
trait:vm(animal, ainv)!trait_tarsus.1                      6.5826478 3.6364929
trait:vm(animal, ainv)!trait_tarsus.2                     12.8988848 8.0388517
units:trait!R                                              1.0000000        NA
units:trait!trait!tarsus.2:!trait!tarsus.1.cor             0.0000000        NA
units:trait!trait_tarsus.1                                14.8727602 3.6375549
units:trait!trait_tarsus.2                                10.7604420 6.2948051
                                                            z.ratio bound %ch
trait:byear!trait_tarsus.1                                2.1399167     U   0
trait:byear!trait_tarsus.2                                2.5078553     U   0
trait:mother!trait_tarsus.1                               0.7735373     U   0
trait:mother!trait_tarsus.2                               1.5489160     U   0
trait:vm(animal, ainv)!trait!tarsus.2:!trait!tarsus.1.cor 2.1539720     U   0
trait:vm(animal, ainv)!trait_tarsus.1                     1.8101638     U   0
trait:vm(animal, ainv)!trait_tarsus.2                     1.6045681     U   0
units:trait!R                                                    NA     F   0
units:trait!trait!tarsus.2:!trait!tarsus.1.cor                   NA     F  NA
units:trait!trait_tarsus.1                                4.0886696     P   0
units:trait!trait_tarsus.2                                1.7094162     P   0</code></pre>
</div>
<div class="sourceCode" id="cb168"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co">###########</span></span>
<span><span class="va">DvsS</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span></span>
<span>  Trait <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span><span class="op">(</span><span class="va">model.BiV_Sex</span><span class="op">$</span><span class="va">coefficients</span><span class="op">$</span><span class="va">random</span><span class="op">)</span>,</span>
<span>  BLUP <span class="op">=</span> <span class="va">model.BiV_Sex</span><span class="op">$</span><span class="va">coefficients</span><span class="op">$</span><span class="va">random</span>,</span>
<span>  SE <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span><span class="op">(</span><span class="va">model.BiV_Sex</span><span class="op">$</span><span class="va">vcoeff</span><span class="op">$</span><span class="va">random</span> <span class="op">*</span> <span class="va">model.BiV_Sex</span><span class="op">$</span><span class="va">sigma2</span><span class="op">)</span></span>
<span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html">grepl</a></span><span class="op">(</span><span class="st">"vm\\(animal"</span>, <span class="va">Trait</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span></span>
<span>    ID <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/substr.html">substr</a></span><span class="op">(</span><span class="va">Trait</span>, <span class="fl">33</span>, <span class="fl">36</span><span class="op">)</span>,</span>
<span>    TRAIT <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/substr.html">substr</a></span><span class="op">(</span><span class="va">Trait</span>, <span class="fl">7</span>, <span class="fl">14</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">rename</span><span class="op">(</span></span>
<span>    BLUP <span class="op">=</span> <span class="st">"effect"</span></span>
<span>  <span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">select</span><span class="op">(</span><span class="va">BLUP</span><span class="op">:</span><span class="va">TRAIT</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">DvsS</span><span class="op">$</span><span class="va">TRAIT</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>tarsus.1 tarsus.2 
    1309     1309 </code></pre>
</div>
<div class="sourceCode" id="cb170"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co">#</span></span>
<span></span>
<span><span class="va">BLUPS</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/reshape.html">reshape</a></span><span class="op">(</span><span class="va">DvsS</span>, v.names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"BLUP"</span>, <span class="st">"SE"</span><span class="op">)</span>, idvar <span class="op">=</span> <span class="st">"ID"</span>, timevar <span class="op">=</span> <span class="st">"TRAIT"</span>, direction <span class="op">=</span> <span class="st">"wide"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">BLUPS</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1309</code></pre>
</div>
<div class="sourceCode" id="cb172"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span><span class="op">(</span><span class="va">BLUPS</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">BLUPS</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"ID"</span>, <span class="st">"BLUP.1"</span>, <span class="st">"SE.1"</span>, <span class="st">"BLUP.2"</span>, <span class="st">"SE.2"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">BLUPS</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>      ID                BLUP.1             SE.1           BLUP.2        
 Length:1309        Min.   :-4.2702   Min.   :1.724   Min.   :-6.10276  
 Class :character   1st Qu.:-0.7149   1st Qu.:2.010   1st Qu.:-0.99945  
 Mode  :character   Median : 0.0000   Median :2.127   Median : 0.00000  
                    Mean   : 0.0718   Mean   :2.198   Mean   : 0.09409  
                    3rd Qu.: 0.8386   3rd Qu.:2.421   3rd Qu.: 1.15952  
                    Max.   : 4.9297   Max.   :2.677   Max.   : 7.57246  
      SE.2      
 Min.   :2.375  
 1st Qu.:2.679  
 Median :3.051  
 Mean   :3.041  
 3rd Qu.:3.375  
 Max.   :3.732  </code></pre>
</div>
<div class="sourceCode" id="cb174"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co">###########</span></span>
<span><span class="va">Y</span> <span class="op">&lt;-</span> <span class="va">BLUPS</span><span class="op">$</span><span class="va">BLUP.1</span></span>
<span><span class="va">X</span> <span class="op">&lt;-</span> <span class="va">BLUPS</span><span class="op">$</span><span class="va">BLUP.2</span></span>
<span><span class="va">se.Y</span> <span class="op">&lt;-</span> <span class="va">BLUPS</span><span class="op">$</span><span class="va">SE.1</span></span>
<span><span class="va">se.X</span> <span class="op">&lt;-</span> <span class="va">BLUPS</span><span class="op">$</span><span class="va">SE.2</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">X</span>, <span class="va">Y</span>, xlab <span class="op">=</span> <span class="st">""</span>, ylab <span class="op">=</span> <span class="st">""</span>, las <span class="op">=</span> <span class="fl">1.2</span>, bty <span class="op">=</span> <span class="st">"o"</span>, col <span class="op">=</span> <span class="st">"white"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/arrows.html">arrows</a></span><span class="op">(</span>x0 <span class="op">=</span> <span class="va">X</span>, y0 <span class="op">=</span> <span class="va">Y</span> <span class="op">-</span> <span class="va">se.Y</span>, x1 <span class="op">=</span> <span class="va">X</span>, y1 <span class="op">=</span> <span class="va">Y</span> <span class="op">+</span> <span class="va">se.Y</span>, col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grDevices/rgb.html">rgb</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0.2</span><span class="op">)</span>, code <span class="op">=</span> <span class="fl">3</span>, angle <span class="op">=</span> <span class="fl">90</span>, length <span class="op">=</span> <span class="fl">0</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/arrows.html">arrows</a></span><span class="op">(</span>x0 <span class="op">=</span> <span class="va">X</span> <span class="op">-</span> <span class="va">se.X</span>, y0 <span class="op">=</span> <span class="va">Y</span>, x1 <span class="op">=</span> <span class="va">X</span> <span class="op">+</span> <span class="va">se.X</span>, y1 <span class="op">=</span> <span class="va">Y</span>, col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grDevices/rgb.html">rgb</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0.2</span><span class="op">)</span>, code <span class="op">=</span> <span class="fl">3</span>, angle <span class="op">=</span> <span class="fl">90</span>, length <span class="op">=</span> <span class="fl">0</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/points.html">points</a></span><span class="op">(</span><span class="va">X</span>, <span class="va">Y</span>, pch <span class="op">=</span> <span class="fl">1</span>, col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grDevices/rgb.html">rgb</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0</span>, <span class="fl">1</span>, <span class="fl">0.2</span><span class="op">)</span>, cex <span class="op">=</span> <span class="fl">1.5</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/points.html">points</a></span><span class="op">(</span><span class="va">X</span>, <span class="va">Y</span>, pch <span class="op">=</span> <span class="fl">16</span>, col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grDevices/rgb.html">rgb</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0</span>, <span class="fl">1</span>, <span class="fl">0.2</span><span class="op">)</span>, cex <span class="op">=</span> <span class="fl">1.5</span><span class="op">)</span></span>
<span><span class="co"># abline(v=0,lty=3);abline(h=0,lty=3)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/mtext.html">mtext</a></span><span class="op">(</span><span class="st">"Male tarsus (BV±SE)"</span>, side <span class="op">=</span> <span class="fl">2</span>, line <span class="op">=</span> <span class="fl">2</span>, las <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/mtext.html">mtext</a></span><span class="op">(</span><span class="st">"Female tarsus (BV±SE)"</span>, side <span class="op">=</span> <span class="fl">1</span>, line <span class="op">=</span> <span class="fl">2.2</span><span class="op">)</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="03_01-biv_asreml_files/figure-html/unnamed-chunk-38-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>The B matrix used the same code but in a multivariate animal model framework. Here some example code, however due to the nature of the dataset, the cross-sex genetic covariance for birth weight is hard to estimate making difficulty to fit this multivariate animal model.</p>
<div class="cell">
<div class="sourceCode" id="cb175"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">temp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/asreml/man/asreml.html">asreml</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="va">tarsus.1</span>, <span class="va">bwt.1</span>, <span class="va">tarsus.2</span>, <span class="va">bwt.2</span><span class="op">)</span> <span class="op">~</span> <span class="va">trait</span>,</span>
<span>  random <span class="op">=</span> <span class="op">~</span> <span class="fu">us</span><span class="op">(</span><span class="va">trait</span><span class="op">)</span><span class="op">:</span><span class="fu">vm</span><span class="op">(</span><span class="va">animal</span>, <span class="va">ainv</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/diag.html">diag</a></span><span class="op">(</span><span class="va">trait</span><span class="op">)</span><span class="op">:</span><span class="va">byear</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/diag.html">diag</a></span><span class="op">(</span><span class="va">trait</span><span class="op">)</span><span class="op">:</span><span class="va">mother</span>,</span>
<span>  residual <span class="op">=</span> <span class="op">~</span> <span class="va">units</span><span class="op">:</span><span class="fu">us</span><span class="op">(</span><span class="va">trait</span><span class="op">)</span>,</span>
<span>  data <span class="op">=</span> <span class="va">gryphon</span>, na.action <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/asreml/man/na.method.html">na.method</a></span><span class="op">(</span>y <span class="op">=</span> <span class="st">"include"</span>, x <span class="op">=</span> <span class="st">"include"</span><span class="op">)</span>, maxiter <span class="op">=</span> <span class="fl">20</span>,</span>
<span>  start.values <span class="op">=</span> <span class="cn">T</span></span>
<span><span class="op">)</span></span>
<span><span class="va">G</span> <span class="op">&lt;-</span> <span class="va">temp</span><span class="op">$</span><span class="va">vparameters</span><span class="op">[</span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">18</span><span class="op">)</span>, <span class="op">]</span></span>
<span><span class="va">R</span> <span class="op">&lt;-</span> <span class="va">temp</span><span class="op">$</span><span class="va">vparameters</span><span class="op">[</span><span class="op">-</span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">18</span><span class="op">)</span>, <span class="op">]</span></span>
<span><span class="co">#</span></span>
<span><span class="va">G</span><span class="op">$</span><span class="va">Constraint</span> <span class="op">&lt;-</span> <span class="st">"U"</span></span>
<span><span class="va">R</span><span class="op">$</span><span class="va">Value</span><span class="op">[</span><span class="fl">5</span><span class="op">:</span><span class="fl">6</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span><span class="va">R</span><span class="op">$</span><span class="va">Constraint</span><span class="op">[</span><span class="fl">5</span><span class="op">:</span><span class="fl">6</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"F"</span></span>
<span><span class="va">R</span><span class="op">$</span><span class="va">Value</span><span class="op">[</span><span class="fl">8</span><span class="op">:</span><span class="fl">9</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span><span class="va">R</span><span class="op">$</span><span class="va">Constraint</span><span class="op">[</span><span class="fl">8</span><span class="op">:</span><span class="fl">9</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"F"</span></span>
<span><span class="co">#</span></span>
<span><span class="co"># model.MultV_Sex&lt;-asreml(cbind(tarsus.1,bwt.1,tarsus.2,bwt.2)~trait,</span></span>
<span><span class="co">#          random=~us(trait):vm(animal,ainv)+</span></span>
<span><span class="co">#         diag(trait):byear +   diag(trait):mother,</span></span>
<span><span class="co">#         residual = ~units:us(trait),</span></span>
<span><span class="co">#         data=gryphon,na.action=na.method(y="include",x="include"),maxiter=20,</span></span>
<span><span class="co">#     G.param=G,R.param=R)</span></span>
<span><span class="co"># model.MultV_Sex&lt;-update.asreml(model.MultV_Sex)</span></span>
<span><span class="co">#</span></span>
<span><span class="co"># summary(model.MultV_Sex)$varcomp</span></span></code><button title="Copier vers le presse-papier" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>


<div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" data-line-spacing="2" role="list" style="display: none">
<div id="ref-wilson2010" class="csl-entry" role="listitem">
Wilson, A. J., D. Réale, M. N. Clements, M. M. Morrissey, E. Postma, C. A. Walling, L. E. B. Kruuk, et D. H. Nussey. 2010. <a href="https://doi.org/10.1111/j.1365-2656.2009.01639.x">An Ecologist’s Guide to the Animal Model</a>. Journal of Animal Ecology 79:13‑26.
</div>
</div>
</section></main><!-- /main --><script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
    const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
    const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
    let newTheme = '';
    if(darkModeDefault) {
      newTheme = isAlternate ? baseTheme : alternateTheme;
    } else {
      newTheme = isAlternate ? alternateTheme : baseTheme;
    }
    const changeGiscusTheme = () => {
      // From: https://github.com/giscus/giscus/issues/336
      const sendMessage = (message) => {
        const iframe = document.querySelector('iframe.giscus-frame');
        if (!iframe) return;
        iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
      }
      sendMessage({
        setConfig: {
          theme: newTheme
        }
      });
    }
    const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
    if (isGiscussLoaded) {
      changeGiscusTheme();
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  const darkModeDefault = false;
  let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
    toggleGiscusIfUsed(toAlternate, darkModeDefault);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copié");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copié");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/wam-tutorial\.github\.io\/fr\/");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script><nav class="page-navigation"><div class="nav-page nav-page-previous">
      <a href="./03_00-biv.html" class="pagination-link" aria-label="Multivariate animal model">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">Multivariate animal model</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./03_03-biv_mcmcglmm.html" class="pagination-link" aria-label="MCMCglmm">
        <span class="nav-page-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">MCMCglmm</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer"><div class="nav-footer">
    <div class="nav-footer-left">
<p>Par J Martin &amp; M Videlier</p>
</div>   
    <div class="nav-footer-center">
      &nbsp;
    <div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/wam-tutorial/fr/edit/main/03_01-biv_asreml.qmd" class="toc-action"><i class="bi bi-github"></i>Modifier cette page</a></li><li><a href="https://github.com/wam-tutorial/fr/issues/new" class="toc-action"><i class="bi empty"></i>Faire part d'un problème</a></li></ul></div></div>
    <div class="nav-footer-right">
<p>Ce livre a été conçu avec <a href="https://quarto.org/">Quarto</a>.</p>
</div>
  </div>
</footer>


</body></html>
